var pornstarIds=[],psThumbs=[],Crowdsource=function(){function c(e,t,s){var a,r='<ul class="tagsHolder">';if("js-pornstarResults"==t)for(a=0;a<e.length;a++)r+='<li><img src="'+s[a]+'"><span>'+e[a]+'</span><button type="button" class="deleteTag"></button></li>';r+="</ul>";var n=document.getElementById(t);n&&(n.innerHTML=r)}return{addSuggestionItems:function(e,t,s){var a,r,n,l,i,o=MG_Utils.closest(t,".crowdSuggestWrap"),u=t.innerText,d=MG_Utils.getData(t,"thumb");if(-1!==e.indexOf(u)||void 0===u)return!o||(a=o.querySelector(".js-responseMessage"))&&(a.innerHTML='<p class="errorRed">'+VIDEO_SHOW.validationText.duptext+"</p>"),!1;e.push(u),void 0!==d&&psThumbs.push(d),c(e,s,psThumbs),o&&(r=o.querySelector(".acList"),n=o.querySelector('button[type="submit"]'),l=o.querySelector(".crowdForm"),i=o.querySelector(".js-responseMessage"),r&&n&&l&&i&&(r.innerHTML="",n.disabled=!1,l.reset(),i.innerHtml=""))},addSuggestionCustom:function(e,t,s){var a,r,n=MG_Utils.closest(t,".crowdSuggestWrap");if(parentList=!!n&&n.querySelector(".acList"),validationParent=!!n&&n.querySelector(".js-responseMessage"),nextSibling=!!t&&MG_Utils.nextElementSibling(t),value=!!nextSibling&&nextSibling.value,value=value&&value.replace(/[\<\>|\[\]|\{\}|\(\)|*|?|!|@|#|$|%|^|&|*|~|`|"|'|:|;]/gi,""),!(-1===e.indexOf(value)&&2<=value.length&&value.length<=20))return validationParent&&(value.length<2||20<value.length?(validationParent.innerHTML='<p class="errorRed">'+VIDEO_SHOW.validationText.notPornstarName+"</p>",nextSibling&&(nextSibling.value="")):-1!==e.indexOf(value)&&(validationParent.innerHTML='<p class="errorRed">'+VIDEO_SHOW.validationText.duptext+"</p>",nextSibling&&(nextSibling.value=""))),parentList&&(parentList.innerHTML=""),!1;e.push(value),psThumbs.push(VIDEO_SHOW.customPornstarThumb),c(e,s,psThumbs),parentList&&(parentList.innerHTML=""),n&&(a=n.querySelector('button[type="submit"]'),r=n.querySelector(".crowdForm"),a&&r&&(a.disabled=!1,r.reset())),validationParent&&(validationParent.innerHTML="")},submitSuggestion:function(r,n,l){var e,t=n.dataset,i=MG_Utils.closest(n,".crowdSuggestWrap"),s={pornstars:r};r.length?jQuery.ajax({url:t.submitUrl,type:"POST",data:s,dataType:"json",success:function(e){var t,s,a;r.length=0,psThumbs.length=0,i&&(t=i.querySelector(".crowdForm"),s=i.querySelector(".js-resultsCrowdTags"),t&&s&&(t.reset(),s.innerHTML="")),MG_Utils.hasClass(n,"js-pornstarSuggestion")&&(l&&l.closeModal(),(a=document.querySelector(".js-pornstarSuggestionSuccess"))&&MG_Utils.addClass(a,"display")),n.disabled=!0}}):!i||(e=i.querySelector(".js-responseMessage"))&&(e.innerHTML='<p class="errorRed">'+t.fail+"</p>")},removeSuggestionItems:function(e,t,s){var a,r;MG_Utils.previousElementSibling(e)&&function(e,t,s){var a=e.indexOf(t);s&&s.splice(a,1);-1!=a&&e.splice(a,1)}(t,MG_Utils.previousElementSibling(e).innerText,s),0===t.length&&(!(a=MG_Utils.closest(e,".crowdSuggestWrap"))||(r=a.querySelector('button[type="submit"]'))&&(r.disabled=!0));var n=MG_Utils.closest(e,".tagsHolder"),l=MG_Utils.closest(e,"li");n&&l&&n.removeChild(l)},voteMapping:function(i,o,u,d){i&&u&&Object.keys(i).map(function(e,t){var s,a,r=i[e].split("|"),n=e.split("."),l=!!d&&d.querySelector("div.existingWrap");MG_Utils.hasClass(u,"upVote")&&l&&o==parseInt(r[1])&&1==parseInt(r[0])&&n[0]==MG_Utils.getData(l,"vid")?(s=MG_Utils.nextElementSibling(u),MG_Utils.addClass(u,"triggerUp"),u.disabled=!0,s&&(MG_Utils.addClass(s,"disableVote"),s.disabled=!0)):MG_Utils.hasClass(u,"downVote")&&l&&o==parseInt(r[1])&&0==parseInt(r[0])&&n[0]==MG_Utils.getData(l,"vid")&&(a=MG_Utils.previousElementSibling(u),MG_Utils.addClass(u,"triggerDown"),u.disabled=!0,a&&(MG_Utils.addClass(a,"disableVote"),a.disabled=!0))})}}}();MG_Utils.domReady(function(){var i,e=document.getElementById("pornstar-box"),t=document.querySelector(".add-pornstar-btn-2"),o=new CrowdSource_AC;e&&(i=new MG_Modal({content:e,className:"suggestionContainer"})),"undefined"!=typeof pornstarSuggestion&&t&&t.addEventListener("click",function(){ga("send","event","Watch Page","click","Add Pornstar"),i&&i.openModal(function(e,a){var t,s,r,n,l;a&&(a.addEventListener("click",function(e){var t=MG_Utils.hasClass(e.target,"upVote")?e.target:e.target.parentElement&&MG_Utils.hasClass(e.target.parentElement,"upVote")?e.target.parentElement:null,s=MG_Utils.hasClass(e.target,"downVote")?e.target:e.target.parentElement&&MG_Utils.hasClass(e.target.parentElement,"downVote")?e.target.parentElement:null;null==t||t.disabled||MG_Utils.ajaxCall({url:MG_Utils.getData(t,"suggestpornstar-url"),type:"POST",success:function(){var e=MG_Utils.nextElementSibling(t);MG_Utils.addClass(t,"triggerUp"),t.disabled=!0,e&&(MG_Utils.addClass(e,"disableVote"),e.disabled=!0)}}),null==s||s.disabled||MG_Utils.ajaxCall({url:MG_Utils.getData(s,"suggestpornstar-url"),type:"POST",success:function(){var e=MG_Utils.previousElementSibling(s);MG_Utils.addClass(s,"triggerDown"),s.disabled=!0,e&&(MG_Utils.addClass(e,"disableVote"),e.disabled=!0)}})}),(t=a.querySelectorAll(".js-buttonVotes"))&&[].forEach.call(t,function(e){var t=MG_Utils.getData(e,"pornstarid"),s=JSON.parse(getCookieAdvanced("videoPornstarRated"));Crowdsource.voteMapping(s,t,e,a)}),o.init({inputID:"searchInputPornstar",modal:a,listRows:4,listTpl:a.querySelector("#js-autocompletePornstar").innerHTML,ajaxUrl:MG_Utils.getData(a.querySelector("#searchInputPornstar"),"autocomplete")}),(s=a.querySelector(".acList"))&&s.addEventListener("click",function(e){var t=e.target;"LI"==t.tagName&&Crowdsource.addSuggestionItems(pornstarIds,t,"js-pornstarResults")}),(r=a.querySelector(".js-addSuggestion"))&&r.addEventListener("click",function(){Crowdsource.addSuggestionCustom(pornstarIds,this,"js-pornstarResults")}),(n=a.querySelector(".js-resultsCrowdTags"))&&n.addEventListener("click",function(e){var t=e.target;MG_Utils.hasClass(t,"deleteTag")&&Crowdsource.removeSuggestionItems(t,pornstarIds,psThumbs)}),(l=a.querySelector(".js-submitSuggestions"))&&l.addEventListener("click",function(e){e.preventDefault();Crowdsource.submitSuggestion(pornstarIds,this,i)}))})})});