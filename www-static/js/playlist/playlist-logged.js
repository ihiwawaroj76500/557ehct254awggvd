var currentVkey,tagModal=[],numberofPl=playlists.length;function forwardVideoKeyForNewPlaylist(e){for(var t=document.querySelectorAll(".playlist-modal"),a=0;a<t.length;a++)t[a].setAttribute("data-vkey",e)}function slideReveal(e){var t,a,l=0;e.style.height="",e.style.position="relative",e.style.zIndex="-1",e.style.display="block",a=parseInt(getStyle(e,"height")),e.style.height="0",e.style.position="",e.style.zIndex="0",t=setInterval(function(){parseInt(getStyle(e,"height"))<a?(l+=1,e.style.height=l+"px"):clearInterval(t)},30)}function slideHide(e){var t,a=parseInt(getStyle(e,"height"));e.style.overflow="hidden",t=setInterval(function(){0<parseInt(getStyle(e,"height"))?(--a,e.style.height=a+"px",0<parseInt(getStyle(e,"padding"))&&(e.style.padding=parseInt(getStyle(e,"padding"))-1+"px")):(clearInterval(t),e.style.zIndex="",e.style.display="",e.style.padding="")},30)}function getStyle(e,t){return window.getComputedStyle?getComputedStyle(e,"")[t]:e.currentStyle?e.currentStyle[t]:void 0}function fadeIn(e){e.style.opacity=0,e.style.display="block";var t,a=10*getStyle(e,"opacity");clearInterval(t),t=setInterval(function(){a<10?(a++,e.style.opacity=(a/10).toFixed(1)):(clearInterval(t),t=0)},50)}function findInArray(e,t){for(var a=t.length,l=0;l<a;l++)if(t[l]==e)return l;return-1}function setupNewPListCreation(){var e=document.getElementsByTagName("BODY")[0];MG_Utils.addEventHandler(e,"click",function(e){var t,s,a,l,i,d=document.getElementById("js-tagsListModal"),o=(e=e||window.event).target||e.srcElement;"add-playlist"===o.getAttribute("id")&&(MG_Utils.preventDefault(e),dropdown.init("#playlist-form .subFilter"),t="undefined"!=typeof vKeyAddVideo?vKeyAddVideo:document.querySelector(".playlist-modal").getAttribute("data-vkey"),s=document.getElementById("new-playlist-title").value.sanitizeMultilingual(),a=document.getElementById("new-playlist-description").value.sanitizeMultilingual(),l=(document.querySelector(".createPlaylistContainer")?document.querySelector(".createPlaylistContainer").querySelector("#new-playlist-privacy"):document.getElementById("new-playlist-privacy")).querySelector("ul.filterListItem li.active").getAttribute("data-value"),i=document.getElementById("playlist-form").querySelector(".error"),document.getElementById("new-playlist-title").value=s,document.getElementById("new-playlist-description").value=a,s&&d.value.length?"function"==typeof validateBannedWords&&validateBannedWords(s+" "+a,!1,function(e){e?(MG_Utils.setText(i,WIDGET_PLAYLIST_HEADER.errorForbiddenWords),i.style.display="block"):(document.getElementById("add-playlist").setAttribute("disabled","disabled"),modal_hide_timeout=!0,MG_Utils.ajaxCall({url:WIDGET_PLAYLIST_HEADER.urlNewPL,type:"POST",dataType:"text/html",data:{title:s,tags:d.value,description:a,vkey:t,status:l,token:token},success:function(e){document.getElementById("playlist-form").style.display="none";var t=document.createElement("div"),a=document.getElementById("modalWrapMTubes").querySelector(".playlist-modal"),l=a.querySelector(".modal-title");t.className="succesMsg","spam"==e?(l.innerHTML=WIDGET_PLAYLIST_HEADER.errorDescriptionToManyUrls+"!",MG_Utils.addClass(l,"failureRed"),MG_Utils.setText(t,s+" "+WIDGET_PLAYLIST_HEADER.errorCouldNotCreate)):"error_vkey"==e?(l.innerHTML=WIDGET_PLAYLIST_HEADER.errorNoVideo+"!",MG_Utils.addClass(l,"failureRed"),MG_Utils.setText(t,s+" "+WIDGET_PLAYLIST_HEADER.errorCouldNotCreate)):"forbidden"==e?(l.innerHTML=WIDGET_PLAYLIST_HEADER.errorCantCreate+"!",MG_Utils.addClass(l,"failureRed"),MG_Utils.setText(t,WIDGET_PLAYLIST_HEADER.errorForbiddenWords)):(l.innerHTML=WIDGET_PLAYLIST_HEADER.successNewPlaylist+"!",MG_Utils.addClass(l,"successGreen"),MG_Utils.setText(t,WIDGET_PLAYLIST_HEADER.successVideoAdded+": "+s)),a.appendChild(t),setTimeout(function(){location.reload()},2e3)}}).fail(function(){clearModalPlaylist()}))}):(MG_Utils.setText(i,WIDGET_PLAYLIST_HEADER.errorMissingInfo),i.style.display="block"))})}function clearModalPlaylist(){void 0!==tagModal&&(tagModal=[]),document.getElementById("playlist-form").querySelector(".error").style.display="none";var e=document.getElementById("modalWrapMTubes").querySelector(".playlist-modal"),t=e.querySelector(".modal-title"),a=e.querySelector(".succesMsg");MG_Utils.removeClass(t,"successGreen"),t.innerHTML=WIDGET_PLAYLIST_HEADER.createPL,a&&a.parentNode.removeChild(a),document.getElementById("add-playlist").removeAttribute("disabled")}function favoritePlaylist(e,t){var a=document.querySelector(".favPlaylist"),l=document.getElementById("favoritePlaylist"),s=document.querySelector(".errorMessageSpam");if(MG_Utils.hasClass(a,"js-disableSpam")&&s)return"block"!==getStyle(s,"display")&&(slideReveal(s),setTimeout(function(){slideHide(s)},1800)),!1;MG_Utils.hasClass(a,"favorited")?MG_Utils.ajaxCall({url:WIDGET_PLAYLIST_HEADER.urlRemoveFavoritePL,type:"GET",data:{playlist_id:e,token:t},success:function(e){MG_Utils.removeClass(a,"favorited"),l&&l.setAttribute("data-title",WIDGET_PLAYLIST_HEADER.favoritePL)}}):MG_Utils.ajaxCall({url:WIDGET_PLAYLIST_HEADER.urlFavoritePL,type:"GET",data:{playlist_id:e,token:t},success:function(e){var t;1==e?(MG_Utils.addClass(a,"favorited"),l&&l.setAttribute("data-title",WIDGET_PLAYLIST_HEADER.alreadyInFavorite)):"block"!==getStyle(t=document.querySelector(".errorMessage"),"display")&&(slideReveal(t),setTimeout(function(){slideHide(t)},5e3))}}),s&&(MG_Utils.addClass(a,"js-disableSpam"),setTimeout(function(){MG_Utils.removeClass(a,"js-disableSpam")},2e3))}function removePlFromFavorite(e,a){MG_Utils.ajaxCall({url:WIDGET_PLAYLIST_HEADER.urlRemoveFavoritePL,type:"GET",data:{playlist_id:e},success:function(e){var t=document.getElementById(a);t.parentNode.removeChild(t)}})}function playlistAppend(){var t,a,l,s;"undefined"==typeof playlists||(t=document.getElementById("addToPlaylist"))&&playlists.forEach(function(e){s=document.createElement("span"),(l=document.createElement("a")).href="javascript:",l.className="playlist-add-video",l.setAttribute("_id",e.id),MG_Utils.setText(l,e.title),l.appendChild(s),(a=document.createElement("li")).appendChild(l),t.appendChild(a)})}function playlistAppendAsc(){var t,a,l;"undefined"==typeof playlistsByTitleAsc||(t=document.getElementById("changePlaylist"))&&playlistsByTitleAsc.forEach(function(e){(l=document.createElement("a")).href="/view_video.php?viewkey="+e.video_vkey+"&pkey="+e.id,MG_Utils.setText(l,e.title),(a=document.createElement("li")).appendChild(l),t.appendChild(a)})}function setupPListEvents_WatchPage(){var e=document.getElementById("custom-playlist-detailed")?document.getElementById("custom-playlist-detailed"):document.querySelectorAll(".custom-playlist-detailed");if(e)if(document.getElementById("custom-playlist-detailed"))playlistEvents(e);else for(var t=0;t<e.length;t++)playlistEvents(e[t])}function playlistEvents(e){MG_Utils.addEventHandler(e,"click",function(e){var t=(e=e||window.event).target||e.srcElement,a=null;switch(t&&(a="LI"==t.nodeName?t.querySelector("a"):"SPAN"==t.nodeName||"VAR"==t.nodeName?MG_Utils.closest(t,".js-addToPlaylistAnchor"):t),a?a.getAttribute("data-type"):""){case"custom":addToCustomPlaylist.call(this,a);break;case"lovers":addToLoversPlaylistVideos.call(this,a);break;default:addToWatchLaterPlaylist.call(this,a)}})}function addToWatchLaterPlaylist(e){var t,a;e&&(1==watchLaterFull?alert(WIDGET_PLAYLIST_HEADER.warningMaxVideos+"."):(t=this.getAttribute("_vkey"),a=e.closest("li"),MG_Utils.hasClass(a,"saved")?fadeIn(e.querySelector(".alreadyInPlaylistMessage")):(MG_Utils.ajaxCall({url:WIDGET_PLAYLIST_HEADER.urladdToPL,type:"GET",data:{type:"watchlater",vkey:t,token:token},success:function(e){document.getElementById("watchLaterCount").innerHTML=e.videos_count}}),MG_Utils.addClass(a,"saved"),fadeIn(e.querySelector(".savedToPlaylistMessage")))))}function addToCustomPlaylist(t){if(t)for(var e,a,l=this.getAttribute("_vkey"),s=t.getAttribute("_id"),i=0;i<numberofPl;i++){s==playlists[i].id&&(1==playlists[i].isFull?alert(WIDGET_PLAYLIST_HEADER.warningMaxVideos+"."):(e=t.closest("li"),MG_Utils.hasClass(e,"saved")?fadeIn(t.querySelector(".alreadyInPlaylistMessage")):(a=t.getAttribute("data-videoid"),MG_Utils.ajaxCall({url:WIDGET_PLAYLIST_HEADER.urladdToPL,type:"GET",data:{type:"playlist",playlist_id:s,vkey:l,token:token},success:function(e){(document.getElementById("watchLaterCount_"+a)?document.getElementById("watchLaterCount_"+a):t.querySelector(".watchLaterCount_"+a)).innerHTML=e.videos_count}}),MG_Utils.addClass(e,"saved"),fadeIn(t.querySelector(".savedToPlaylistMessage")))))}}function addToLoversPlaylistVideos(e){var t,a,l,s,i;e&&(t=this.getAttribute("_vkey"),a=MG_Utils.closest(e,"li"),l=e.querySelector("#loversPlaylistCount"),s=e.querySelector(".savedToPlaylistMessage"),i=e.querySelector(".alreadyInPlaylistMessage"),s&&i&&l&&(MG_Utils.hasClass(a,"saved")?fadeIn(i):(addToLoversPlaylistRequest(t,function(e){e&&e.videos_count&&(l.innerHTML=e.videos_count)}),MG_Utils.addClass(a,"saved"),fadeIn(s))))}function addToLoversPlaylistRequest(e,t){e&&"function"==typeof t&&MG_Utils.ajaxCall({url:WIDGET_PLAYLIST_HEADER.urladdToPL,type:"GET",data:{type:"lovers",vkey:e,token:token},success:t})}function setupPListEvents_VideoThumbs(){var e=document.querySelector(".watchlater-add");e&&MG_Utils.addEventHandler(e,"click",addToWatchLater);var t=document.querySelector(".lover-playlist-add");t&&MG_Utils.addEventHandler(t,"click",addToLoversPlaylist);var a=document.getElementById("addToPlaylist");a&&MG_Utils.addEventHandler(a,"click",addToCustomPL)}function addToWatchLater(e){MG_Utils.preventDefault(e);var t,a,l,s,i,d=vKeyAddVideo,o=document.querySelector('[_vkey="'+d+'"]'),n=o.querySelector("img").getAttribute("src"),r=o.querySelector(".premiumIcon")?"1":"0",u=this;if(1==watchLaterFull)alert(WIDGET_PLAYLIST_HEADER.warningMaxVideos+".");else if(!MG_Utils.hasClass(this,"added")&&(MG_Utils.ajaxCall({url:WIDGET_PLAYLIST_HEADER.urladdToPL,type:"GET",data:{type:"watchlater",vkey:d,token:token},success:function(e){var t=u.closest(".quicklick");MG_Utils.addClass(t,"added")}}),playlist_menu_fadeout(u),"undefined"!=typeof playlistId&&"undefined"!=typeof videosVkeys&&-1===findInArray(d,videosVkeys)&&(videos.push({privacy:"public",premium:r,rating:currentRating,vkey:d,smallThumb:currentThumb,xSmallThumbNew:n,title:currentTitle,durationFormatted:currentDuration}),"undefined"!=typeof originalShuffleStatus&&1==originalShuffleStatus||"undefined"!=typeof shuffleStatus&&1==shuffleStatus?((s=getCookie("playlistShuffle_"+playlistId).split(",")).push(d),s.sort(function(){return.5-Math.random()}),i=s.join(",")+"path=/;",setCookie("playlistShuffle_"+playlistId,i),shuffledNextVkey=s[getNextPosition(currentVkey,s)],shuffledPrevVkey=s[getPrevPosition(currentVkey,s)]):(videosVkeys.push(d),nextVkey=videosVkeys[getNextPosition(currentVkey,videosVkeys)]),t=videos.length-1,writeDetailItem(t,videos),$j(".carousel-navigation").jcarousel("reload"),(a=document.querySelectorAll(".carousel-navigation li"))&&3<a.length))){for(l=0;l<a.length;l++)MG_Utils.removeClass(a[l],"last");MG_Utils.addClass(a[a.length-1],"last")}}function addToLoversPlaylist(e){e.preventDefault();var t=vKeyAddVideo,a=this;MG_Utils.hasClass(this,"added")||(addToLoversPlaylistRequest(t,function(e){var t;e&&e.videos_count&&(t=MG_Utils.closest(a,".quicklick"),MG_Utils.addClass(t,"added"))}),playlist_menu_fadeout(this))}function addToCustomPL(e){var a,t,l,s,i,d,o=(e=e||window.event).target||e.srcElement,n=vKeyAddVideo,r=document.querySelector('[_vkey="'+n+'"]'),u=r.querySelector("img").getAttribute("src"),c=r.querySelector(".premiumIcon")?"1":"0";if(o&&"A"==o.nodeName&&(a=MG_Utils.hasClass(o,"playlist-add-video")?o:null),a)for(t=a.getAttribute("_id"),l=0;l<numberofPl;l++){if(t==playlists[l].id)if(1==playlists[l].isFull)alert(WIDGET_PLAYLIST_HEADER.warningMaxVideos+".");else if(!MG_Utils.hasClass(a,"added"))if(MG_Utils.ajaxCall({url:WIDGET_PLAYLIST_HEADER.urladdToPL,type:"GET",data:{type:"playlist",playlist_id:t,vkey:n,token:token},success:function(e){var t=a.closest("li");MG_Utils.addClass(t,"added"),a.querySelector("span").textContent=TRANSLATED_MESSAGE.added}}),playlist_menu_fadeout(this),"undefined"!=typeof playlistId)if(playlistId==t)if("undefined"!=typeof videosVkeys&&-1===findInArray(n,videosVkeys))if(videos.push({rating:currentRating,premium:c,vkey:n,xSmallThumbNew:u,smallThumb:currentThumb,title:currentTitle,durationFormatted:currentDuration}),"undefined"!=typeof originalShuffleStatus&&1==originalShuffleStatus||"undefined"!=typeof shuffleStatus&&1==shuffleStatus?((i=getCookie("playlistShuffle_"+playlistId).split(",")).push(n),i.sort(function(){return.5-Math.random()}),d=i.join(",")+"path=/;",setCookie("playlistShuffle_"+playlistId,d),shuffledNextVkey=i[getNextPosition(currentVkey,i)],shuffledPrevVkey=i[getPrevPosition(currentVkey,i)]):(videosVkeys.push(n),nextVkey=videosVkeys[getNextPosition(currentVkey,videosVkeys)]),s=videos.length-1,writeDetailItem(s,videos),$j(".carousel-navigation").jcarousel("reload"),carouselItems=document.querySelectorAll(".carousel-navigation li"),carouselItems&&3<carouselItems.length){for(l=0;l<carouselItems.length;l++)MG_Utils.removeClass(carouselItems[l],"last");MG_Utils.addClass(carouselItems[carouselItems.length-1],"last")}}}var displayErrorModal=function(e){var t=document.getElementById("tagErrorDisplayModal");t.innerHTML="";var a=document.createElement("span");a.className="tagListError",a.textContent=e,t.appendChild(a)},handleTagDisplayModal=function(e){var t='<li class="tagButton"><div class="labelTag removeTagButtonModal"></div><div class="labelText removeTagButtonModal"><span class="tagText removeTagButtonModal">'+e+'</span><span class="labelIcon removeTagButtonModal"></span></div></li>';document.getElementById("tagListModal").innerHTML+=t},handleRemoveTagModal=function(e){var t,a,l,s,i=e.target;MG_Utils.hasClass(i,"removeTagButtonModal")&&(e.preventDefault(),t=i.parentNode.textContent,0<=(a=tagModal.indexOf(t))&&tagModal.splice(a,1),tagModal.toString().replace(/(,|\s)/g,"").length<150&&(document.getElementById("tagErrorDisplayModal").innerHTML=""),document.getElementById("tagListModal").innerHTML="",tagModal.forEach(handleTagDisplayModal),l=document.getElementById("js-tagsListModal"),s=tagModal.join("|"),l.value=s.replace(/\s/gi,"+"))},handleAddTagModal=function(e){var t=e.target;if(MG_Utils.hasClass(t,"js-addTagModal")){e.preventDefault();var i=document.getElementById("addTagInputModal");if(i.value=i.value.replace(/[^a-zA-Z0-9 ]/g,"").trim(),i.value.length<3)return displayErrorModal('Tag "'+i.value+'" not valid. Must contain a minimum of 3 characters!');if(20<i.value.length)return displayErrorModal('Tag "'+i.value+'" not valid. Tags are maximum 20 characters!');if(-1<tagModal.map(function(e){return e.toLowerCase()}).indexOf(i.value.toLowerCase()))return displayErrorModal("No duplicate tags allowed!");"function"==typeof validateBannedWords&&validateBannedWords(i.value.toLowerCase(),!1,function(e){var t,a,l,s;e?displayErrorModal('Tag "'+i.value+'" is considered to be a banned word.'):(document.getElementById("tagListModal").innerHTML="",tagModal.push(i.value),150<(t=tagModal.toString().replace(/(,|\s)/g,"")).length&&(0<=(a=tagModal.indexOf(i.value))&&tagModal.splice(a,1)),tagModal.forEach(handleTagDisplayModal),document.getElementById("tagErrorDisplayModal").innerHTML="",150<t.length&&displayErrorModal("You have reached the maximum tag limit."),l=document.getElementById("js-tagsListModal"),s=tagModal.join("|"),l.value=s.replace(/\s/gi,"+"),i.value="")})}},handleKeyPressModal=function(e){var t,a=e.target;MG_Utils.hasClass(a,"js-addTagInputModal")&&188==(e.keyCode?e.keyCode:e.which)&&((t=document.getElementById("addTagInputModal")).value=t.value.replace(/,/g,""),document.getElementById("addTagModal").click())},clearTagsModal=function(e){var t=e.target;(MG_Utils.hasClass(t,"buttonMTubes")||MG_Utils.hasClass(t,"createPlaylistContainer"))&&void 0!==tagModal&&(tagModal=[])};document.addEventListener("click",handleRemoveTagModal),document.addEventListener("click",handleAddTagModal),document.addEventListener("keyup",handleKeyPressModal),document.addEventListener("click",clearTagsModal),MG_Utils.domReady(function(){playlistAppend(),playlistAppendAsc(),setupPListEvents_WatchPage(),setupPListEvents_VideoThumbs(),setupNewPListCreation()});