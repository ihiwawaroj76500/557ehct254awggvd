var PurchaseFlow_Utils=function(){"use strict";var u=this;u.trackingCreditCardParams={},u.getCurrentOpenedModal=function(e,t){if(t=void 0!==t&&t,e.querySelector(".active_modal")){var o=e.querySelector(".active_modal").getAttribute("data-modal");return t?e.querySelector("."+o):o}return""},u.openSelectedModal=function(e,t){t.querySelector(".active_modal")&&MG_Utils.removeClass(t.querySelector(".active_modal"),"active_modal"),MG_Utils.addClass(t.querySelector(e),"active_modal")},u.addModalCloseListeners=function(a,r,i,n){n=void 0!==n?n:function(){};function t(e){var t,o;MG_Utils.hasClass(a,"leave_confirmation")?(t="leave_confirmation_modal"==u.getCurrentOpenedModal(a)&&"close_button"===e,"leave_confirmation_modal"!=u.getCurrentOpenedModal(a)?(a.querySelector(".leave_confirmation_modal .leave_confirmation_buttons").setAttribute("data-previousModal",u.getCurrentOpenedModal(a)),u.openSelectedModal(".leave_confirmation_modal",a)):t&&(o=a.querySelector(".leave_confirmation_modal .leave_confirmation_buttons").getAttribute("data-previousModal"),u.openSelectedModal("."+o,a))):(i.closeModal(n),MG_Utils.hasClass(a,"reload_on_close")?r.dismissUrl?window.location.href=r.dismissUrl:window.location.reload(!0):MG_Utils.hasClass(a,"redirect_on_close")&&r.redirectWithoutParamsUrl&&(window.location.href=r.redirectWithoutParamsUrl))}MG_Utils.addEventHandler(document.querySelector("#modalWrapMTubes"),"click",function(e){"modalWrapMTubes"===(e.target&&e.target.id||e.srcElement&&e.srcElement.id)&&(getSelection().toString()||MG_Utils.hasClass(a,"cannot_close")||t("outer_close"))}),[].forEach.call(a.querySelectorAll(".js_close_modal"),function(e){MG_Utils.addEventHandler(e,"click",function(){t("close_button")})})},u.addLeaveModalListeners=function(o,t,a,r){r=void 0!==r?r:function(){},MG_Utils.addEventHandler(o.querySelector(".js_cancel_leave_modal"),"click",function(e){var t=e.target.parentElement.getAttribute("data-previousModal");u.openSelectedModal("."+t,o)}),MG_Utils.addEventHandler(o.querySelector(".js_confirm_leave_modal"),"click",function(e){a.closeModal(r),"undefined"!=typeof recaptchaComplete&&(recaptchaComplete=!1),PurchaseFlow_LoginSignup.requireCaptcha=!1,"pfCreditCardModal"==e.target.parentElement.getAttribute("data-previousModal")&&u.trackCreditCardModal(PF_CREDITCARDMODAL_TRACKING.trackingStatus.ccFormClose),MG_Utils.hasClass(o,"reload_on_close")&&(t.dismissUrl?window.location.href=t.dismissUrl:"?customvideo=1"===window.location.search?window.location.href=window.location.origin+window.location.pathname:window.location.reload(!0))})},u.ageModal_triggerPurchaseFlow=function(){"undefined"!=typeof fanclubPurchaseFlowParams&&fanclubPurchaseFlowParams.triggerPurchaseFlow&&fanclubPurchaseFlowParams.modelId&&fanclubPurchaseFlow.triggerPurchaseModal(fanclubPurchaseFlowParams.modelId),"undefined"!=typeof customVideoPurchaseFlowParams&&customVideoPurchaseFlowParams.triggerCustomVideo&&customVideoPurchaseFlowParams.modelId&&customVideoPurchaseFlow.triggerPurchaseFlow(customVideoPurchaseFlowParams.modelId,!0),"undefined"!=typeof Tipping_PurchaseFlow_Params&&Tipping_PurchaseFlow_Params.isModelPage&&("#tip"===window.location.hash||0<window.location.search.indexOf("sendTip=1"))&&Tipping_PurchaseFlow_Params.modelUsername&&tippingPurchaseFlow.triggerPurchaseFlow(Tipping_PurchaseFlow_Params.modelUsername)},u.noAgeModal=function(e){var t=document.getElementById("js-ageDisclaimerModal")&&!getCookieAdvanced("accessAgeDisclaimerPH"),o=e.vkOauth_ageModal,a=e.utah_ageModal&&!getCookieAdvanced("accessPH");return!t&&!o&&!a},u.openSuccessModal=function(e,t,o,a){a=void 0!==a&&a,o.openModal();var r,i,n=document.querySelector(e),l=n.querySelector(".fanclubUpsell");u.openSelectedModal(".pf_success_modal",n),MG_Utils.addClass(n,"redirect_on_close"),u.addModalCloseListeners(n,t,o),a&&"function"==typeof a&&a(n),l&&(r=n.querySelector(".js_fanclubUpsell"),i=document.querySelectorAll(".modalMTubes .fcUpsellVideoList"),MG_Utils.addClass(n,"withUpsell"),0<i.length&&MG_Scroll.init({selector:i,width:"auto",height:"auto",color:"#555",railColor:"#2e2e2e",railOpacity:"1",opacity:"1",wrapperClass:"scrollContentWrapper",horizontal:!0}),r&&r.addEventListener("click",function(e){o.closeModal(),fanclubPurchaseFlow.triggerPurchaseModal(r.getAttribute("data-model_id")),"undefined"!=typeof history&&history.pushState&&void 0!==t.redirectWithoutParamsUrl&&history.pushState({},null,t.redirectWithoutParamsUrl)}))},u.addChangeCCListeners=function(e,o,a,r){a=void 0!==a&&a,r=void 0!==r&&r,e.addEventListener("click",function(e){var t;MG_Utils.hasClass(e.target,"jsChangeCC")&&(t=a&&r?r.getAjaxData():{},e.target.hasAttribute("data-model_id")&&(t.modelId=e.target.getAttribute("data-model_id")),t.newCC=!0,MG_Utils.ajaxCall({type:"POST",data:t,url:o,success:function(e){"PASS"==e.success&&(window.location.href=e.redirectUrl)}}))})},u.toggleLoading=function(e,t,o){var a=e.querySelector(".purchase_loading_img").cloneNode(!0);t&&a&&("show"==o?(t.setAttribute("data-originalText",t.innerText),t.innerHTML="",t.appendChild(a)):(t.removeChild(t.querySelector(".purchase_loading_img")),t.innerText=t.getAttribute("data-originalText")))},u.addFailureModalTryAgainListener=function(o,a,r,i,n){i=!(void 0===i||!i)&&i,MG_Utils.addEventHandler(a,"click",function(e){purchaseFlow_Utils.toggleLoading(o,a,"show");var t={tryAgain:!0};i&&(t=MG_Utils.extendSimple(t,i)),MG_Utils.ajaxCall({type:"POST",data:t,url:r,success:function(e){"PASS"!=e.success&&e.error?purchaseFlow_Utils.toggleLoading(o,a,"hide"):"function"==typeof n?n(e.redirectUrl,e.pornhubUUID):window.location.href=e.redirectUrl}})})},u.showCreditCardModal=function(e){return!MG_Utils.hasClass(document.documentElement,"ie")&&void 0!==e.needCC&&e.needCC},u.setupCreditCardModal=function(e,t,o,a){o=!(void 0===o||!o)&&o;var r,i,n,l=!(!(a=!(void 0===a||!a)&&a)||void 0===a.al)&&a.al,s=e.querySelector(".ccPurchaseInfo");u.trackingCreditCardParams={productID:s.getAttribute("data-trackingProductID"),modelId:s.getAttribute("data-trackingModelID"),amount:s.getAttribute("data-trackingAmount"),isDiscounted:u.trackingCreditCardParams.isDiscounted?u.trackingCreditCardParams.isDiscounted:s.getAttribute("data-trackingIsDiscounted"),transactionId:null,premiumUserInfo:null,itemId:s.getAttribute("data-trackingItemId")},o&&(r=-1!==o.indexOf("$")?"":"$",i=e.querySelector(".totalPrice .priceRight"),e.querySelector(".ccPurchasePrice").innerText=r+o,u.trackingCreditCardParams.amount=o,i&&!i.innerText&&(n=(r+o).replace(/ \/ \w+/g,""),creditCardV2.setPriceValues("set",e,n))),u.openSelectedModal(".pfCreditCardModal",e),MG_Utils.addClass(e,"leave_confirmation"),MG_Utils.addClass(e,"cannot_close"),CREDIT_CARD_MODAL.getProbillerApiUrl=t,a&&(CREDIT_CARD_MODAL.getProbillerApiAjaxData=a),CREDIT_CARD_MODAL.modelId=u.trackingCreditCardParams.modelId,l&&(CREDIT_CARD_MODAL.premiumUserInfo=l,u.trackingCreditCardParams.premiumUserInfo=l),u.trackCreditCardModal(PF_CREDITCARDMODAL_TRACKING.trackingStatus.ccFormOpen),creditCardModule.init(e,CREDIT_CARD_FORM.version)},u.trackCreditCardModal=function(e){MG_Utils.ajaxCall({type:"POST",url:PF_CREDITCARDMODAL_TRACKING.trackingUrl,data:{modelId:u.trackingCreditCardParams.modelId,amount:u.trackingCreditCardParams.amount,productID:u.trackingCreditCardParams.productID,site:"ph",isDiscounted:u.trackingCreditCardParams.isDiscounted,modelState:e,transactionId:u.trackingCreditCardParams.transactionId,al:u.trackingCreditCardParams.premiumUserInfo,itemId:u.trackingCreditCardParams.itemId}})},u.setupCouponCode=function(e,t){couponCodeModule.init(e,t)}};try{var purchaseFlow_Utils=new PurchaseFlow_Utils}catch(e){console.log("ERROR === Purchase Flow Utils ==="),console.log(e)}var couponCodeModule=function(){var r={};function i(e){e=void 0!==e&&e,MG_Utils.addClass(r.inputCoupon,"error"),e?r.couponError.innerText=e:0==r.inputCoupon.value.length&&(r.couponError.innerText=pfCouponCode_Params.noCouponError)}function n(e){"disable"==e?(MG_Utils.addClass(r.submitBtn,"disabled"),r.submitBtn.setAttribute("disabled",!0)):(MG_Utils.removeClass(r.submitBtn,"disabled"),r.submitBtn.removeAttribute("disabled"))}function l(e,t,o,a){r.purchaseFlow.params.couponCode=e,PF_CREDITCARDMODAL_TRACKING.isDiscounted=e?1:0,!pfCouponCode_Params.liu&&purchaseFlow_LoginSignup&&(purchaseFlow_LoginSignup.params.couponCode=e),"v2"==CREDIT_CARD_FORM.version&&(null==e?creditCardV2.setPriceValues("reset",o):creditCardV2.setPriceValues("set",o,t,a))}return{init:function(o,e){var t,a=purchaseFlow_Utils.getCurrentOpenedModal(o,!0);if(!document.querySelector(".addCouponContainer"))return!1;l(null,(r={purchaseFlow:e,addCouponContainer:a.querySelector(".addCouponContainer"),showCouponFieldBtn:a.querySelector(".js-showCouponField"),couponFieldSection:a.querySelector(".inputCoupon"),successfulCouponSection:a.querySelector(".successfulCoupon"),inputCoupon:a.querySelector(".js-couponCodeInput"),submitBtn:a.querySelector(".js-submitCouponCode"),couponError:a.querySelector(".couponError"),removeCoupon:a.querySelector(".js-removeCoupon"),priceElm:a.querySelector(".js-pfPurchasePrice"),originalPriceElm:a.querySelector(".js-pfPurchasePrice").cloneNode(!0)}).addCouponContainer.getAttribute("data-originalPrice"),o),n("disable"),r.showCouponFieldBtn&&r.showCouponFieldBtn.addEventListener("click",function(){MG_Utils.addClass(r.showCouponFieldBtn,"displayNone"),r.couponFieldSection&&MG_Utils.removeClass(r.couponFieldSection,"displayNone")}),r.inputCoupon&&r.inputCoupon.addEventListener("keyup",function(e){0<e.target.value.length?(n("enable"),"13"==e.keyCode&&r.submitBtn&&r.submitBtn.click()):n("disable")}),r.submitBtn&&r.submitBtn.addEventListener("click",function(){var t;MG_Utils.removeClass(r.inputCoupon,"error"),r.couponError.innerText="",r.inputCoupon,0<r.inputCoupon.value.length&&!MG_Utils.hasClass(r.submitBtn,"disabled")?(n("disable"),t=r.inputCoupon.value,MG_Utils.ajaxCall({type:"POST",data:{modelId:r.addCouponContainer.getAttribute("data-modelId"),itemId:r.addCouponContainer.getAttribute("data-itemId"),couponCode:t,itemType:r.addCouponContainer.getAttribute("data-itemType")},url:pfCouponCode_Params.applyCouponUrl,success:function(e){"FAIL"==e.success||e.error?(i(e.message),n("enable")):(l(t,e.finalAmount,o,e.finalDiscountPercent),r.successfulCouponSection&&(MG_Utils.removeClass(r.successfulCouponSection,"displayNone"),r.successfulCouponSection.querySelector(".greenText").innerText="'"+t+"'",r.successfulCouponSection.querySelector(".js-amountOff").innerText=e.finalDiscountPercent),r.priceElm&&(r.priceElm.setAttribute("data-originalPercent",r.priceElm.getAttribute("data-percent")),r.priceElm.setAttribute("data-percent",e.finalDiscountPercent),r.priceElm.innerHTML='<div class="strikethrough">'+r.addCouponContainer.getAttribute("data-originalPrice")+"</div>"+e.finalAmount),r.couponFieldSection&&MG_Utils.addClass(r.couponFieldSection,"displayNone"),r.inputCoupon&&(r.inputCoupon.value=""),e.isGift&&MG_Utils.addClassMultiple(o.querySelectorAll(".changeCardContainer"),"display-none"))}})):i()}),r.removeCoupon.addEventListener("click",function(){l(null,r.addCouponContainer.getAttribute("data-originalPrice"),o),n("enable"),r.successfulCouponSection&&(MG_Utils.addClass(r.successfulCouponSection,"displayNone"),r.successfulCouponSection.querySelector(".greenText").innerText="",r.successfulCouponSection.querySelector(".js-amountOff").innerText=""),r.priceElm&&(r.priceElm.innerHTML=r.originalPriceElm.innerHTML,r.priceElm.setAttribute("data-percent",r.priceElm.getAttribute("data-originalPercent"))),r.couponFieldSection&&MG_Utils.removeClass(r.couponFieldSection,"displayNone"),MG_Utils.removeClassMultiple(o.querySelectorAll(".changeCardContainer"),"display-none")}),(t=function(e){var t=window.location.search,o=t.indexOf(e);return-1<o?(searchLocationNew=t.substring(o),-1<searchLocationNew.indexOf("&")?searchLocationNew.substring(0,searchLocationNew.indexOf("&")):searchLocationNew.substring(0)):""}("coupon="))&&r.showCouponFieldBtn&&r.inputCoupon&&r.submitBtn&&(r.showCouponFieldBtn.click(),r.inputCoupon.value=t.replace("coupon=",""),n("enable"),r.submitBtn.click())},applyCoupon:function(e){e&&r.showCouponFieldBtn&&r.inputCoupon&&r.submitBtn&&(r.showCouponFieldBtn.click(),r.inputCoupon.value=e,n("enable"),r.submitBtn.click())}}}(),pfLast4=function(){var i={};function n(e){var t=(e=void 0!==e?e:i.currentModal).querySelectorAll(".lastFour"),o="";return[].forEach.call(t,function(e){o+=e.value}),o}function l(e){var t=e.target;t&&MG_Utils.hasClass(t,"lastFour")&&t.select()}return{init:function(e,t,o){o=void 0!==o&&o;var a=purchaseFlow_Utils.getCurrentOpenedModal(e,!0);i={purchaseFlow:t,parentModal:e,currentModal:a,last4Container:a.querySelector(".pfLastDigits"),first6:a.querySelector(".first6"),userAvatar:a.querySelector(".digitsUserAvatar"),userName:a.querySelector(".digitsUserName"),submitButton:a.querySelector(".jsLastDigitsSubmit")};var r=closestElement(a,".purchaseFlowModal");r&&MG_Utils.addClass(r,"withLast4"),o&&o.first6&&function(e){{var t,o;i.first6&&(t=e.substring(0,4),o=e.substring(4,6),i.first6.innerHTML=t+"<span>"+o+"**</span>****",MG_Utils.addClass(i.first6,"active"))}}(o.first6),o&&o.avatar&&o.username&&i.userAvatar&&i.userName&&(i.userAvatar.setAttribute("src",o.avatar),i.userName.innerText=o.username),i.last4Container&&(i.last4Container.addEventListener("focus",l,!0),MG_Utils.browser.isAppleMobileDevice&&i.last4Container.addEventListener("click",l,!0),i.last4Container.addEventListener("input",function(e){var t=e.target;MG_Utils.hasClass(t,"lastFour")&&1<=t.value.length&&(t.value=t.value.slice(0,1),MG_Utils.hasClass(t,"lastFourEnd")||t.nextElementSibling.focus(),4==n().length&&i.submitButton&&MG_Utils.removeClass(i.submitButton,"disabled"))},!0),i.last4Container.addEventListener("keydown",function(e){var t,o;MG_Utils.hasClass(e.target,"lastFour")&&(o=(t=e.keyCode||e.which)<96||105<t,-1==[9,8,46,13,16,229].indexOf(t)&&(t<48||57<t)&&o&&e.preventDefault(),"13"==e.keyCode&&i.submitButton&&!MG_Utils.hasClass(i.submitButton,"disabled")&&(MG_Utils.addClass(i.submitButton,"disabled"),i.purchaseFlow.handleLastDigitsAjax(i.parentModal,i.currentModal,n(),i.submitButton)))},!0))},getLast4:n}}();
var FanclubPurchaseFlow=function(){"use strict";var o=this,r=[];o.defaultSettings={showSuccessModal:!1,showFailureModal:!1,dynamicallyTargetButton:!0,dismissUrl:"",fanClubPrice:"",modelId:""},o.pornhubUUID=null,o.init=function(e){o.params=MG_Utils.extendSimple(o.defaultSettings,e),o.initModals(),o.add_listeners()},o.initModals=function(){o.purchaseFlowModal=new MG_Modal({closeButton:!1,closeDocument:!1,content:document.querySelector(".fanclub_purchase_flow_modals_container"),className:"fanclubPurchaseFlowModal purchaseFlowModal",lazyload:!0})},o.add_listeners=function(){var e,a,t;o.params.dynamicallyTargetButton?MG_Utils.addEventHandler(document,"click",function(e){var a,t;e.target&&(t=(a=e.target.parentNode)?a.parentNode:null,MG_Utils.hasClass(e.target,"js_becomeFan")?o.triggerPurchaseModal(e.target.getAttribute("data-model_id")):a&&MG_Utils.hasClass(a,"js_becomeFan")?o.triggerPurchaseModal(a.getAttribute("data-model_id")):t&&MG_Utils.hasClass(t,"js_becomeFan")&&o.triggerPurchaseModal(t.getAttribute("data-model_id")))}):(e=document.querySelectorAll(".js_becomeFan"),[].forEach.call(e,function(a){MG_Utils.addEventHandler(a,"click",function(e){o.triggerPurchaseModal(a.getAttribute("data-model_id"))})})),o.params.triggerPurchaseFlow&&o.params.isModelPage&&o.params.modelId&&purchaseFlow_Utils.noAgeModal(o.params)&&o.triggerPurchaseModal(o.params.modelId),o.params.showSuccessModal&&purchaseFlow_Utils.openSuccessModal(".contentMTubes .fanclub_purchase_flow_modals",o.params,o.purchaseFlowModal),o.params.showFailureModal&&(o.purchaseFlowModal.openModal(),a=document.querySelector(".contentMTubes .fanclub_purchase_flow_modals"),purchaseFlow_Utils.openSelectedModal(".pf_failure_modal",a),MG_Utils.addClass(a,"redirect_on_close"),purchaseFlow_Utils.addModalCloseListeners(a,o.params,o.purchaseFlowModal),t=purchaseFlow_Utils.getCurrentOpenedModal(a,!0).querySelector(".js_retryPurchase"),purchaseFlow_Utils.addFailureModalTryAgainListener(a,t,o.params.changeCCAjax,o.getAjaxData(),o.trackLegacyProbiller))},o.addNewEventHandlers=function(a,e){MG_Utils.addEventHandler(a.querySelector(".js_purchase_modal_submit"),"click",function(e){MG_Utils.addClass(e.target,"disabled"),"true"==e.target.getAttribute("data-loginSignup")?(purchaseFlow_Utils.openSelectedModal(".login_signup_modal",a),purchaseFlow_LoginSignup.addListeners(a,fanclubPurchaseFlow),o.removeInlineOnclick(["js_purchase_flow_login","js_purchase_flow_signup"])):e.target.hasAttribute("data-needCC")?purchaseFlow_Utils.setupCreditCardModal(a,o.params.initiatePurchaseFlowAjax,o.params.fanClubPrice,o.getAjaxData()):o.trackLegacyProbiller(e.target.getAttribute("data-redirectUrl"))}),MG_Utils.addEventHandler(a.querySelector(".js_report_other_perks"),"click",function(e){MG_Utils.hasClass(e.target,"disabled")||o.reportOtherPerks(e.target)}),MG_Utils.addEventHandler(a.querySelector(".js_alreadyFanTip"),"click",function(e){o.purchaseFlowModal.closeModal(function(){window.location=e.target.getAttribute("data-url"),o.params.isModelPage&&!o.params.dismissUrl&&window.location.reload(!0)})}),purchaseFlow_Utils.addModalCloseListeners(a,o.params,o.purchaseFlowModal),purchaseFlow_Utils.addLeaveModalListeners(a,o.params,o.purchaseFlowModal),purchaseFlow_Utils.addChangeCCListeners(a,o.params.changeCCAjax)},o.addLastDigitEventListeners=function(e,a){var t=purchaseFlow_Utils.getCurrentOpenedModal(e,!0),l=t.querySelector(".jsLastDigitsSubmit");pfLast4.init(e,fanclubPurchaseFlow,a),l&&l.addEventListener("click",function(){MG_Utils.hasClass(l,"disabled")||(MG_Utils.addClass(l,"disabled"),o.callGoogleAnalytics(l),o.handleLastDigitsAjax(e,t,pfLast4.getLast4(t),l))})},o.triggerPurchaseModal=function(t){o.purchaseFlowModal.openModal(function(){MG_Utils.addClass(document.querySelector(".modalMTubes.fanclubPurchaseFlowModal"),"loadingModal"),MG_Utils.ajaxCall({type:"POST",data:{modelId:t},url:o.params.initiatePurchaseFlowAjax,success:function(a){MG_Utils.removeClass(document.querySelector(".modalMTubes.fanclubPurchaseFlowModal"),"loadingModal");var e=document.querySelector(".contentMTubes .fanclub_purchase_flow_modals");void 0!==a.pbMonitoring.uuid&&(o.pornhubUUID=a.pbMonitoring.uuid),"PASS"==a.success?(purchaseFlow_Utils.openSelectedModal(".fanclub_purchase_modal",e),o.replaceModelInfo(a,e,t),o.addNewEventHandlers(e,a),o.populatePurchaseModal(a,e),document.querySelector('div[data-ga="purchase_logged_in"]')&&o.removeInlineOnclick(["jsLastDigitsSubmit"]),350<e.querySelector(".fanclub_purchase_top_content").clientHeight&&o.initScroll(e.querySelectorAll(".fanclub_purchase_top_content"),"100%","350px")):a&&void 0!==a.fanclubInactive&&a.fanclubInactive&&(e=document.querySelector(".contentMTubes .fanclub_purchase_flow_modals"),MG_Utils.addClass(e.querySelector(".inactive_fanclub_modal"),"active_modal"),[].forEach.call(e.querySelectorAll(".modelName"),function(e){e.innerText=a.modelInfo.modelName}),purchaseFlow_Utils.addModalCloseListeners(e,o.params,o.purchaseFlowModal))}})})},o.trackLegacyProbiller=function(a,e){void 0!==e&&""!==e&&(o.pornhubUUID=e),MG_Utils.ajaxCall({type:"POST",requestType:"text/json; charset=UTF-8",data:{pornhubUUID:o.pornhubUUID},url:o.params.probillerMonitoringFanclubLegacy,success:function(e){void 0!==a&&""!==a&&(window.location.href=a)},error:function(){void 0!==a&&""!==a&&(window.location.href=a)}})},o.populatePurchaseModal=function(e,t){e.perks&&e.perks.forEach(function(e){var a=t.querySelector(".perks_template .perk_container").cloneNode(!0);a.querySelector(".perk_content").innerText=e,t.querySelector(".fanclub_purchase_perks_list").appendChild(a)}),e.otherPerks&&(e.otherPerks.forEach(function(e){var a=t.querySelector(".perks_template .perk_container").cloneNode(!0);a.querySelector(".perk_content").innerText=e,t.querySelector(".fanclub_purchase_other_perks_list").appendChild(a)}),MG_Utils.addClass(t.querySelector(".fanclub_purchase_other_perks"),"active"),MG_Utils.addClass(t.querySelector(".fanclub_purchase_top_content"),"two_perks_list")),e.showLast4?(MG_Utils.addClass(t.querySelector(".fanclub_purchase_bottom"),"purchase_modal_2"),o.addLastDigitEventListeners(t,e)):MG_Utils.addClass(t.querySelector(".fanclub_purchase_bottom"),"purchase_modal_1"),e.loginSignup&&t.querySelector(".js_purchase_modal_submit").setAttribute("data-loginSignup",!0),void 0!==e.redirectUrl&&t.querySelector(".js_purchase_modal_submit").setAttribute("data-redirectUrl",e.redirectUrl),purchaseFlow_Utils.showCreditCardModal(e)&&t.querySelector(".js_purchase_modal_submit").setAttribute("data-needCC",e.needCC),void 0!==e.paidVideoOptOutMessage&&e.paidVideoOptOutMessage&&(t.querySelector(".fanclub_purchase_optout").innerHTML=e.paidVideoOptOutMessage)},o.replaceModelInfo=function(e,a,t){var l=e.modelInfo.modelName,r=e.modelInfo.priceFrequency;a.innerHTML=a.innerHTML.replace(/FANCLUB_PRICE/g,r),a.innerHTML=a.innerHTML.replace(/MODEL_ID/g,t),a.innerHTML=a.innerHTML.replace(/FANCLUB_ID/g,e.fanclubId),a.innerHTML=a.innerHTML.replace(/PRICE_DISCLAIMER/g,e.modelInfo.priceDisclaimer),o.params.modelId=t,[].forEach.call(a.querySelectorAll(".modelName"),function(e){e.innerText=l}),o.params.fanClubPrice=r},o.reportOtherPerks=function(a){MG_Utils.ajaxCall({type:"POST",data:{modelId:o.params.modelId},url:o.params.reportOtherPerksAjax,success:function(e){"PASS"==e.success?(a.innerHTML=o.params.reportOtherPerksThankYouTxt,MG_Utils.addClass(a,"notClickable"),MG_Utils.addClass(a,"disabled")):"FAIL"==e.success&&(a.innerHTML=e.message,MG_Utils.addClass(a,"notClickable"),MG_Utils.addClass(a,"disabled"),MG_Utils.addClass(a,"error"))}})},o.handleLastDigitsAjax=function(a,e,t,l){purchaseFlow_Utils.toggleLoading(a,l,"show");var r=e.querySelector(".pfLastDigitsError");r&&(MG_Utils.removeClass(r,"active"),r.innerHTML=""),MG_Utils.ajaxCall({type:"POST",data:o.getAjaxData(t),url:o.params.lastDigitsAjax,success:function(e){"FAIL"==e.success?(r&&(MG_Utils.addClass(r,"active"),r.innerHTML=e.message),purchaseFlow_Utils.toggleLoading(a,l,"hide"),l&&MG_Utils.removeClass(l,"disabled")):(e.MixpanelEvent&&"undefined"!=typeof mixpanel&&mixpanel.track(e.MixpanelEvent.eventName,e.MixpanelEvent.event),window.location.href=e.redirectUrl)}})},o.initScroll=function(e,a,t){MG_Scroll.init({selector:e,width:a,height:t,color:"#F39000",railColor:"#2e2e2e",railOpacity:"1",opacity:"1",wrapperClass:"scrollContentWrapper"})},o.handleAfterLoginSignup=function(e,a){var t;document.querySelector('div[data-ga="login"]')&&o.callGoogleAnalytics(document.querySelector('div[data-ga="login"]')),MG_Utils.removeClass(e,"leave_confirmation"),MG_Utils.addClass(e,"reload_on_close"),void 0!==a.responseData&&void 0!==a.responseData.redirect&&(o.params.dismissUrl=a.responseData.redirect),void 0!==a.responseData&&void 0!==a.responseData.autoLoginParameter&&(o.params.premiumUserInfo=a.responseData.autoLoginParameter),void 0!==a.last4Required&&a.last4Required?(t=e.querySelector(".fanclub_purchase_bottom"),purchaseFlow_Utils.openSelectedModal(".fanclub_purchase_modal",e),t&&(MG_Utils.removeClass(t,"purchase_modal_1"),MG_Utils.addClass(t,"purchase_modal_2")),document.querySelector('div[data-ga="purchase_after_login"]')&&o.removeInlineOnclick(["jsLastDigitsSubmit"]),o.addLastDigitEventListeners(e,a)):void 0!==a.isAlreadyFan&&a.isAlreadyFan?(purchaseFlow_Utils.openSelectedModal(".already_fan_modal",e),e.querySelector(".already_fan_send_tip").setAttribute("data-url",a.tipUrl)):purchaseFlow_Utils.showCreditCardModal(a)?purchaseFlow_Utils.setupCreditCardModal(e,o.params.initiatePurchaseFlowAjax,o.params.fanClubPrice,o.getAjaxData()):void 0!==a.redirectUrl&&(window.location.href=a.redirectUrl)},o.removeInlineOnclick=function(e){[].forEach.call(e,function(e){var a=document.querySelectorAll(".modalMTubes ."+e);a&&[].forEach.call(a,function(e){o.buildOnclickEvent(e,e.getAttribute("data-ga")),e.onclick=null})})},o.buildOnclickEvent=function(e,a){if(r){for(var t=0;t<r.length;t++)if(r[t][a])return;var l={};l[a]=e.onclick,r.push(l)}},o.callGoogleAnalytics=function(t){r&&[].forEach.call(r,function(e){var a;!t.hasAttribute("data-ga")||(a=e[t.getAttribute("data-ga")])&&a()})},o.getAjaxData=function(e){e=void 0!==e&&e;var a={modelId:o.params.modelId};return o.params.token&&(a.token=o.params.token),o.params.premiumUserInfo&&(a.al=o.params.premiumUserInfo),e&&(a.last4=e),a}};try{var fanclubPurchaseFlow=new FanclubPurchaseFlow;fanclubPurchaseFlow.init("undefined"!=typeof fanclubPurchaseFlowParams?fanclubPurchaseFlowParams:{})}catch(e){console.log("ERROR === Fanclub Purchase Flow ==="),console.log(e)}
var PurchaseFlow_LoginSignup=function(){"use strict";var l=this;l.defaultSettings={timer:null,idleTime:500,signup_errors:{},couponCode:""},l.init=function(e){l.params=MG_Utils.extendSimple(l.defaultSettings,e)},l.addListeners=function(n,e){l.params.purchaseFlow=e,MG_Utils.addClass(n,"leave_confirmation");var o=n.querySelectorAll(".login_signup_tabs_item");[].forEach.call(o,function(i){MG_Utils.addEventHandler(i,"click",function(e){"undefined"!=typeof recaptchaComplete&&(recaptchaComplete=!1),PurchaseFlow_LoginSignup.requireCaptcha=!1;var r=n.getElementsByClassName("g-recaptcha");if(r)for(var a=0;a<r.length;a++)r[a].hasAttribute("id")&&-1<r[a].getAttribute("id").indexOf("cpt")&&("login_signup_modal_login"==i.getAttribute("data-tabid")?r[a].innerHTML="":grecaptcha.reset());MG_Utils.removeClassMultiple(o,"active_tab"),MG_Utils.addClass(e.target,"active_tab");var s=n.querySelectorAll(".login_signup_content_wrap .login_signup_content"),t=n.querySelector("."+e.target.getAttribute("data-tabclass"));MG_Utils.removeClassMultiple(s,"active"),t&&MG_Utils.addClass(t,"active")})}),l.addLoginListeners(n),l.addSignupListeners(n)},l.addLoginListeners=function(r){var e=r.querySelector(".fanclub_login_form"),a=r.querySelector(".js_purchase_flow_login"),s=r.querySelector(".js_pf_login_username"),t=r.querySelector(".js_pf_login_password");a&&a.addEventListener("click",function(e){e.target&&!MG_Utils.hasClass(e.target,"disabled")&&(MG_Utils.addClass(e.target,"disabled"),l.requestLogin(r,e.target))}),e&&e.addEventListener("input",function(e){e.target&&MG_Utils.hasClass(e.target,"pf_login_input")&&s&&t&&""!=s.value&&""!=t.value&&!PurchaseFlow_LoginSignup.requireCaptcha&&a&&MG_Utils.removeClass(a,"disabled")}),e&&e.addEventListener("keyup",function(e){e.target&&MG_Utils.hasClass(e.target,"pf_login_input")&&"13"==e.keyCode&&!MG_Utils.hasClass(a,"disabled")&&(a&&MG_Utils.addClass(a,"disabled"),!e.target||"text"!=e.target.type&&"password"!=e.target.type||e.target.blur(),a&&l.requestLogin(r,a))})},l.requestLogin=function(r,a,s,t){try{grecaptcha.getResponse().length&&l.handleLoginAjax(r,a,s,t)}catch(e){l.handleLoginAjax(r,a,s,t)}},l.addSignupListeners=function(s){l.signupInputs={email:s.querySelector(".js_pf_signup_email"),username:s.querySelector(".js_pf_signup_username"),password:s.querySelector(".js_pf_signup_password"),captcha_token:s.querySelector("#captcha_token")?s.querySelector("#captcha_token"):""},["keyup","input","keypress"].forEach(function(a){["email","username","password"].forEach(function(r){MG_Utils.addEventHandler(l.signupInputs[r],a,function(e){""!=e.target.value&&(l.signup_isInputValid(r,e.target,s)&&l.idleTimeoutValidation(function(){l.signup_backendCheckSetup(e.target,r,s)}),"keyup"!=a||"13"!=e.keyCode||MG_Utils.hasClass(s.querySelector(".js_purchase_flow_signup"),"disabled")||l.signup_submitAjax(s.querySelector(".js_purchase_flow_signup"),s))})})}),["email","username","password"].forEach(function(r){MG_Utils.addEventHandler(l.signupInputs[r],"focus",function(e){""!=e.target.value&&l.params.signup_errors[r]&&(s.querySelector(".fanclub_signup_form .error_message").innerHTML=l.params.signup_errors[r])})}),MG_Utils.addEventHandler(s.querySelector(".js_purchase_flow_signup"),"click",function(e){MG_Utils.hasClass(e.target,"disabled")||(MG_Utils.addClass(e.target,"disabled"),l.signup_submitAjax(e.target,s))})},l.handleLoginAjax=function(s,t,e,i){e=void 0!==e&&e,i=void 0!==i&&i,purchaseFlow_Utils.toggleLoading(s,t,"show");var r={token:l.params.token,username:s.querySelector(".js_pf_login_username").value,password:s.querySelector(".js_pf_login_password").value,remember_me:s.querySelector(".js_pf_login_remember").checked,modelId:t.getAttribute("data-model_id"),login:1,redirect:s.querySelector(".js_pf_login_redirect").value,pageUser:s.querySelector(".js_pf_login_pageUser").value};"undefined"!=typeof recaptchaComplete&&recaptchaComplete&&(r["g-recaptcha-response"]=s.querySelector(".fanclub_login_form .g-recaptcha-response").value),void 0!==l.params.couponCode&&l.params.couponCode&&(r.couponCode=l.params.couponCode),e&&(r=MG_Utils.extendSimple(r,e)),MG_Utils.ajaxCall({type:"POST",url:t.getAttribute("data-submit_url"),data:r,success:function(e){purchaseFlow_Utils.toggleLoading(s,t,"hide");var r;t.getAttribute("data-purchase_flow_type");if(MG_Utils.removeClassMultiple(s.querySelectorAll(".error_message"),"active"),MG_Utils.removeClassMultiple(s.querySelectorAll(".pf_login_input"),"error"),[].forEach.call(s.querySelectorAll(".error_message"),function(e){e.innerHTML=""}),void 0!==e.twoStepVerification&&e.twoStepVerification)MG_Utils.addClass(s.querySelector(".pf_login_form"),"hide"),MG_Utils.addClass(s.querySelector(".pf_login_verification"),"active"),(r=s.querySelector(".pf_login_verification"))&&(r.querySelector(".loginPageVerificationEnabledUsername").value=e.username,r.querySelector(".verificationEnabledToken").value=e.autoLoginParameter,r.querySelector(".loginPageAuthyId").value=e.authyId,r.querySelector(".pf_verify_userNumber").innerText=e.phoneNumber),l.loginVerification_addListeners(s,r);else if(l.responseSuccessCheck(e))i?MG_Utils.addClass(s.querySelector(".pf_verify_message"),"active"):MG_Utils.addClass(s.querySelector(".fanclub_login_form .success_message"),"active"),l.params.purchaseFlow&&l.params.purchaseFlow.handleAfterLoginSignup(s,e);else{if(i)void 0!==e.message&&e.message&&(r=s.querySelector(".pf_login_verification"),MG_Utils.addClass(r.querySelector(".pf_verify_message_error"),"active"),r.querySelector(".pf_verify_message_error").innerText=e.message);else if(s.querySelector(".fanclub_login_form .error_message").innerHTML=e.message,MG_Utils.addClass(s.querySelector(".fanclub_login_form .error_message"),"active"),MG_Utils.addClassMultiple(s.querySelectorAll(".pf_login_input"),"error"),PurchaseFlow_LoginSignup.requireCaptcha=e.requireCaptcha,e.requireCaptcha&&"undefined"!=typeof recaptchaComplete&&"undefined"!=typeof gRecaptchaPublicKey){t.setAttribute("disabled","disabled"),MG_Utils.addClass(s.querySelector(".js_purchase_flow_login"),"disabled");var a=s.querySelector(".fanclub_login_form .g-recaptcha");if(a&&!a.hasAttribute("id"))if(recaptchaComplete)grecaptcha.reset();else try{grecaptcha.render(a,{sitekey:gRecaptchaPublicKey,theme:"dark",callback:function(e){recaptchaComplete=!0,t.removeAttribute("disabled"),MG_Utils.removeClass(s.querySelector(".js_purchase_flow_login"),"disabled")},"expired-callback":function(){MG_Utils.addClass(s.querySelector(".js_purchase_flow_login"),"disabled")}})}catch(e){}}}}})},l.loginVerification_addListeners=function(a,s){var t=s.querySelector(".pf_login_verificationCode");["keyup","input","keypress"].forEach(function(r){MG_Utils.addEventHandler(t,r,function(e){"input"==r&&0<t.value.length&&MG_Utils.removeClass(s.querySelector(".js_pfVerifySubmit"),"disabled"),"keyup"!=r||"13"!=e.keyCode||MG_Utils.hasClass(s.querySelector(".js_pfVerifySubmit"),"disabled")||l.loginVerification_submit(a,s,s.querySelector(".js_pfVerifySubmit")),0===t.value.length&&MG_Utils.addClass(s.querySelector(".js_pfVerifySubmit"),"disabled")})});var r=s.querySelector(".js_pfVerifySubmit");MG_Utils.addEventHandler(r,"click",function(e){MG_Utils.hasClass(r,"disabled")||l.loginVerification_submit(a,s,r)}),MG_Utils.addEventHandler(s.querySelector(".js_pfVerifyResendCode"),"click",function(e){s.querySelector(".pf_verify_resend_msg").innerText="",MG_Utils.removeClass(s.querySelector(".pf_verify_resend_msg"),"active"),MG_Utils.ajaxCall({type:"POST",data:{authyId:s.querySelector(".loginPageAuthyId").value,token:l.params.token},url:l.params.twoStepResendUrl,success:function(e){"success"==e.status?void 0!==e.message&&e.message&&(s.querySelector(".pf_verify_resend_msg").innerText=e.message,MG_Utils.addClass(s.querySelector(".pf_verify_resend_msg"),"active")):void 0!==e.message&&e.message&&(MG_Utils.addClass(s.querySelector(".pf_verify_message_error"),"active"),s.querySelector(".pf_verify_message_error").innerText=e.message)}})})},l.loginVerification_submit=function(e,r,a){var s={username:r.querySelector(".loginPageVerificationEnabledUsername").value,token2:r.querySelector(".verificationEnabledToken").value,verification_modal:1,authyId:r.querySelector(".loginPageAuthyId").value,token:l.params.token,verification_code:r.querySelector(".pf_login_verificationCode").value};l.requestLogin(e,a,s,!0)},l.signup_backendCheckSetup=function(e,r,a){l.signup_ajaxCheck(e,r,e.value,a)},l.signup_hideError=function(e,r,a){MG_Utils.removeClass(e,"invalid"),l.params.signup_errors[r]&&delete l.params.signup_errors[r],0<Object.keys(l.params.signup_errors).length?a.querySelector(".fanclub_signup_form .error_message").innerHTML=l.params.signup_errors[Object.keys(l.params.signup_errors)[0]]:(MG_Utils.removeClass(a.querySelector(".fanclub_signup_form .error_message"),"active"),a.querySelector(".fanclub_signup_form .error_message").innerHTML="")},l.signup_ajaxCheck=function(r,a,e,s){var t={token:l.params.token,redirect:"",check_what:a};t[a]=e,MG_Utils.ajaxCall({type:"POST",url:l.params.checkInputAjax,data:t,success:function(e){""!==e.error_message?l.signup_putError(r,a,e.error_message,s):(l.signup_makeElementValid(r,a,s),l.signup_validateForm(s))},error:function(){console.log("Network Error!")}})},l.idleTimeoutValidation=function(e){l.params.timer&&clearTimeout(l.params.timer),l.params.timer=setTimeout(function(){e()},l.params.idleTime)},l.signup_isInputValid=function(e,r,a){switch(e){case"email":return l.signup_isEmailValid(r,a);case"username":return l.signup_isUsernameValid(r,a);case"password":return l.signup_isPasswordValid(r,a)}},l.signup_isEmailValid=function(e,r){return/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\]|(\[ipv6:)((?:[A-F0-9]{1,4}:){4,}[A-F0-9]{1,4})])/gim.test(e.value)?e.value.length<5?(l.signup_putError(e,"email",l.params.errorMsg.emailTooShort,r),!1):!(254<e.value.length)||(l.signup_putError(e,"email",l.params.errorMsg.emailTooLong,r),!1):(l.signup_putError(e,"email",l.params.errorMsg.invalidEmail,r),!1)},l.signup_isUsernameValid=function(e,r){var a=r.querySelector(".js_pf_signup_password");return e.value.length<5?(l.signup_putError(e,"username",l.params.errorMsg.usernameTooShort,r),!1):18<e.value.length?(l.signup_putError(e,"username",l.params.errorMsg.usernameTooLong,r),!1):""==a.value||a.value!=e.value||(l.signup_putError(e,"username",l.params.errorMsg.usernamePasswordcantMatch,r),!1)},l.signup_isPasswordValid=function(e,r){var a=r.querySelector(".js_pf_signup_username");return e.value.length<6?(l.signup_putError(e,"password",l.params.errorMsg.passwordTooShort,r),!1):40<e.value.length?(l.signup_putError(e,"password",l.params.errorMsg.passwordTooLong,r),!1):""==a.value||a.value!=e.value||(l.signup_putError(e,"password",l.params.errorMsg.usernamePasswordcantMatch,r),!1)},l.signup_putError=function(e,r,a,s){a=void 0!==a?a:"",MG_Utils.addClass(s.querySelector(".js_purchase_flow_signup"),"disabled"),MG_Utils.removeClass(e,"valid"),MG_Utils.addClass(e,"invalid"),e.setAttribute("data-valid",!1),(l.params.signup_errors[r]=a)?(s.querySelector(".fanclub_signup_form .error_message").innerHTML=a,MG_Utils.addClass(s.querySelector(".fanclub_signup_form .error_message"),"active")):l.signup_getError(r,s)},l.signup_getError=function(e,r){l.params.signup_errors[e]&&(r.querySelector(".fanclub_signup_form .error_message").innerHTML=l.params.signup_errors[e],r.querySelector(".fanclub_signup_form .error_message").style.opacity=1)},l.signup_makeElementValid=function(e,r,a){MG_Utils.removeClass(e,"invalid"),MG_Utils.addClass(e,"valid"),e.setAttribute("data-valid",!0),l.signup_hideError(e,r,a)},l.signup_validateForm=function(e){var r=!1;"true"==e.querySelector(".js_pf_signup_email").getAttribute("data-valid")&&"true"==e.querySelector(".js_pf_signup_username").getAttribute("data-valid")&&"true"==e.querySelector(".js_pf_signup_password").getAttribute("data-valid")&&(r=!0),r?MG_Utils.removeClass(e.querySelector(".js_purchase_flow_signup"),"disabled"):MG_Utils.addClass(e.querySelector(".js_purchase_flow_signup"),"disabled")},l.signup_submitAjax=function(s,t){purchaseFlow_Utils.toggleLoading(t,s,"show");var e=l.signupInputs.email.value,r=l.signupInputs.username.value,a=l.signupInputs.password.value,i=l.signupInputs.captcha_token?l.signupInputs.captcha_token.value:"",n={token:l.params.token,"g-recaptcha-response":i,email:e,username:r,password:a,modelId:s.getAttribute("data-model_id"),signup:1,pageUser:t.querySelector(".js_pf_signup_pageUser").value};void 0!==l.params.couponCode&&l.params.couponCode&&(n.couponCode=l.params.couponCode),MG_Utils.ajaxCall({type:"POST",url:s.getAttribute("data-submit_url"),data:n,success:function(e){var r,a;purchaseFlow_Utils.toggleLoading(t,s,"hide"),l.responseSuccessCheck(e)?l.params.purchaseFlow&&l.params.purchaseFlow.handleAfterLoginSignup(t,e):("2"===e.success||(r=t.querySelector(".fanclub_signup_form .error_message"))&&(r.innerHTML=e.message,r.style.display="block"),a=!0,"FAIL"!=e.success||e.showSignupCaptcha||(a=!1),a&&initCaptcha(r,s))}})},l.responseSuccessCheck=function(e){return void 0!==e.success?"PASS"==e.success||"1"===e.success:void 0!==e.responseData&&"1"===e.responseData.success},l.setLoginSignupAjaxUrl=function(e,r){var a,s=e.querySelector(".login_signup_modal");s&&(a=s.querySelectorAll(".jsLoginSignupUrl"),[].forEach.call(a,function(e){e&&e.setAttribute("data-submit_url",r)}))}};try{var purchaseFlow_LoginSignup=new PurchaseFlow_LoginSignup;purchaseFlow_LoginSignup.init("undefined"!=typeof purchaseFlow_LoginSignup_Params?purchaseFlow_LoginSignup_Params:{}),PurchaseFlow_LoginSignup.requireCaptcha=!1}catch(e){console.log("ERROR === Login / Signup Modal ==="),console.log(e)}
var TippingPurchaseFlow=function(){"use strict";var r=this;r.defaultSettings={showSuccessModal:!1,showFailureModal:!1,dismissUrl:"",tipButton_Class:"js-tipsTrigger",triggerPurchaseFlow:!1,submodal_class:".tipping_submodal",showSignupCaptcha:!1,modelUsername:"",vkey:!1,dynamicallyTargetButton:!1,modelId:""},r.init=function(e){r.params=MG_Utils.extendSimple(r.defaultSettings,e),r.initModals(),r.add_listeners()},r.initModals=function(){r.purchaseFlowModal=new MG_Modal({closeButton:!1,closeDocument:!1,content:document.querySelector(".tipping_modals_container"),className:"tippingPurchaseFlowModal purchaseFlowModal",lazyload:!0})},r.add_listeners=function(){var e,a,t;r.params.dynamicallyTargetButton?MG_Utils.addEventHandler(document,"click",function(e){var a,t;e.target&&(t=(a=e.target.parentNode)?a.parentNode:null,MG_Utils.hasClass(e.target,r.params.tipButton_Class)?r.triggerPurchaseFlow(e.target.getAttribute("data-model"),e.target.getAttribute("data-model_id")):a&&MG_Utils.hasClass(a,r.params.tipButton_Class)?r.triggerPurchaseFlow(a.getAttribute("data-model"),a.getAttribute("data-model_id")):t&&MG_Utils.hasClass(t,r.params.tipButton_Class)&&r.triggerPurchaseFlow(t.getAttribute("data-model"),t.getAttribute("data-model_id")))}):(e=document.querySelectorAll("."+r.params.tipButton_Class),[].forEach.call(e,function(a){MG_Utils.addEventHandler(a,"click",function(e){a.getAttribute("data-model")&&r.triggerPurchaseFlow(a.getAttribute("data-model"),a.getAttribute("data-model_id"))})})),("#tip"===window.location.hash||0<window.location.search.indexOf("sendTip=1"))&&r.params.isModelPage&&purchaseFlow_Utils.noAgeModal(r.params)&&r.triggerPurchaseFlow(r.params.modelUsername,r.params.modelId),r.params.showSuccessModal&&purchaseFlow_Utils.openSuccessModal(".modalMTubes.tippingPurchaseFlowModal",r.params,r.purchaseFlowModal),r.params.showFailureModal&&(r.purchaseFlowModal.openModal(),a=document.querySelector(".modalMTubes.tippingPurchaseFlowModal"),purchaseFlow_Utils.openSelectedModal(".pf_failure_modal",a),MG_Utils.addClass(a,"redirect_on_close"),purchaseFlow_Utils.addModalCloseListeners(a,r.params,r.purchaseFlowModal),t=purchaseFlow_Utils.getCurrentOpenedModal(a,!0).querySelector(".js_retryPurchase"),r.params.selectedTipAmount=r.params.transactionTipAmount,purchaseFlow_Utils.addFailureModalTryAgainListener(a,t,r.params.sendTipUrl,r.getAjaxData(!0)))},r.addNewEventHandlers=function(a){r.addTippingModalListeners(a),purchaseFlow_Utils.addModalCloseListeners(a,r.params,r.purchaseFlowModal),purchaseFlow_Utils.addLeaveModalListeners(a,r.params,r.purchaseFlowModal),MG_Utils.addEventHandler(a.querySelector(".js_tipCheckout"),"click",function(e){MG_Utils.addClass(e.target,"disabled"),r.sendTipsAjax(a,!1,!1,a.querySelector(".js_tipCheckout"))}),[].forEach.call(a.querySelectorAll(".js_changeCC"),function(e){MG_Utils.addEventHandler(e,"click",function(){r.sendTipsAjax(a,!0)})})},r.addTippingModalListeners=function(a){var t=a.querySelector(".js-tipsModal"),e=t.querySelectorAll(".inputBox label");[].forEach.call(e,function(e){MG_Utils.addEventHandler(e,"click",function(e){var a=t.querySelector(".js_tippingModalCheckout");a&&MG_Utils.removeClass(a,"disabled")})}),MG_Utils.addEventHandler(t.querySelector(".js_tippingModalCheckout"),"click",function(e){e.preventDefault(),r.submitTippingModal(a)});var l=t.querySelector(".js-tipOther"),s=t.querySelector(".tipOtherCaption");MG_Utils.addEventHandler(l,"click",function(e){s.querySelector(".tipAmount").style.display="none",s.querySelector(".inputTipOther").style.display="block"}),MG_Utils.addEventHandler(s.querySelector(".inputTipOther"),"keydown",function(e){13==e.keyCode&&(e.preventDefault(),r.submitTippingModal(a))})},r.triggerPurchaseFlow=function(a,t){r.purchaseFlowModal.openModal(function(){var e=document.querySelector(".modalMTubes.tippingPurchaseFlowModal .tipping_modals_wrapper");purchaseFlow_Utils.openSelectedModal(".js-tipsModal",e),r.params.modelUsername=a,r.params.modelId=t,e.innerHTML=e.innerHTML.replace(/MODEL_ID/g,t),r.addNewEventHandlers(e),[].forEach.call(e.querySelectorAll(".tippedModel"),function(e){e.innerHTML=r.params.modelUsername})})},r.submitTippingModal=function(e){var a=e.querySelector(".js_tippingModalCheckout");!MG_Utils.hasClass(a,"disabled")&&r.validateTipValue(e)&&(r.params.selectedTipAmount=e.querySelector('.tips .inputBox input[type="radio"]:checked').getAttribute("data-value"),[].forEach.call(e.querySelectorAll(".modelTipAmount"),function(e){e.innerHTML=r.params.selectedTipAmount}),r.params.liu?(r.params.last4?(purchaseFlow_Utils.openSelectedModal(".js-tipsDigits",e),r.addLastDigitEventListeners(e)):purchaseFlow_Utils.openSelectedModal(".js-tipsNoDigits",e),MG_Utils.addClass(e,"leave_confirmation")):(purchaseFlow_Utils.openSelectedModal(".login_signup_modal",e),purchaseFlow_LoginSignup.addListeners(e,tippingPurchaseFlow)))},r.validateTipValue=function(e){var a=!0,t=e.querySelector('.tips .inputBox input[type="radio"]:checked');if(t){var l,s,i=t.parentElement;return MG_Utils.hasClass(t,"js-tipOther")&&(l=i.querySelector(".inputTipOther").value,(a=!!/^\d+$/.test(l)&&(0<(s=parseInt(l))&&s<=150))?(MG_Utils.removeClass(i.querySelector(".inputTipOther"),"error"),t.setAttribute("data-value",l)):(MG_Utils.addClass(i.querySelector(".inputTipOther"),"error"),i.querySelector(".inputTipOther").value="")),a}return!1},r.handleAfterLoginSignup=function(e,a){var t;void 0!==a.liuIsOwner&&a.liuIsOwner?window.location.reload(!0):(void 0!==a.newToken&&a.newToken&&(r.params.token=a.newToken),void 0!==a.last4Required&&a.last4Required?(purchaseFlow_Utils.openSelectedModal(".js-tipsDigits",e),r.addLastDigitEventListeners(e,a)):(purchaseFlow_Utils.openSelectedModal(".js-tipsNoDigits",e),void 0===a.first6||!a.first6||(t=e.querySelectorAll(".js-oneClickChangeCC"))&&MG_Utils.removeClassMultiple(t,"displayNone")),MG_Utils.addClass(e,"leave_confirmation"),MG_Utils.addClass(e,"reload_on_close"),void 0!==a.dismissUrl&&(r.params.dismissUrl=a.dismissUrl),void 0!==a.al&&(r.params.premiumUserInfo=a.al),void 0===a.hasCreditCardSaved||a.hasCreditCardSaved||MG_Utils.addClassMultiple(e.querySelectorAll(".changeCCSection"),"displayNone"))},r.sendTipsAjax=function(t,e,l,s){e=void 0!==e&&e,l=void 0!==l&&l,(s=void 0!==s&&s)&&purchaseFlow_Utils.toggleLoading(t,s,"show");var i=r.getAjaxData(e,l);MG_Utils.ajaxCall({url:r.params.sendTipUrl,type:"POST",data:i,success:function(e){var a=purchaseFlow_Utils.getCurrentOpenedModal(t,!0).querySelector(".js_sendTipError");purchaseFlow_Utils.showCreditCardModal(e)?purchaseFlow_Utils.setupCreditCardModal(t,r.params.sendTipUrl,parseFloat(r.params.selectedTipAmount).toFixed(2),i):e.error?(a&&(a.innerHTML=e.message),l&&(a&&MG_Utils.addClass(a,"active"),s&&MG_Utils.removeClass(s,"disabled")),s&&purchaseFlow_Utils.toggleLoading(t,s,"hide")):(e.MixpanelEvent&&"undefined"!=typeof mixpanel&&mixpanel.track(e.MixpanelEvent.eventName,e.MixpanelEvent.event),a&&(a.innerHTML=""),l&&a&&MG_Utils.removeClass(a,"active"),window.location.href=e.redirectUrl)}})},r.getAjaxData=function(e,a){e=void 0!==e&&e,a=void 0!==a&&a;var t={amount:r.params.selectedTipAmount,username:r.params.modelUsername,token:r.params.token,modelId:r.params.modelId};return r.params.viewkey&&(t.viewkey=r.params.viewkey),r.params.premiumUserInfo&&(t.al=r.params.premiumUserInfo),e&&(t.newCC=1),a&&(t.last4=a),r.params.isChat&&(t.isChat=1),t},r.addLastDigitEventListeners=function(e,a){a=void 0!==a&&a;var t=purchaseFlow_Utils.getCurrentOpenedModal(e,!0),l=t.querySelector(".jsLastDigitsSubmit");pfLast4.init(e,tippingPurchaseFlow,a),l&&l.addEventListener("click",function(){MG_Utils.hasClass(l,"disabled")||(MG_Utils.addClass(l,"disabled"),r.sendTipsAjax(e,!1,pfLast4.getLast4(t),l))})},r.handleLastDigitsAjax=function(e,a,t,l){r.sendTipsAjax(e,!1,t,l)}};try{var tippingPurchaseFlow=new TippingPurchaseFlow;tippingPurchaseFlow.init("undefined"!=typeof Tipping_PurchaseFlow_Params?Tipping_PurchaseFlow_Params:{})}catch(e){console.log("ERROR === Tipping Purchase Flow ==="),console.log(e)}
var VideoPurchaseFlow=function(){"use strict";var t=this;t.defaultSettings={showSuccessModal:!1,showFailureModal:!1,dismissUrl:"",buyVideoButton:".js-purchaseButton",submodal_class:".videoPurchase_submodal",showSignupCaptcha:!1},t.init=function(e){t.params=MG_Utils.extendSimple(t.defaultSettings,e),t.initModals(),t.add_listeners()},t.initModals=function(){t.purchaseFlowModal=new MG_Modal({closeButton:!1,closeDocument:!1,content:document.querySelector(".video_purchase_modals_container"),className:"videoPurchaseFlowModal purchaseFlowModal",lazyload:!0})},t.add_listeners=function(){var e,a,o=document.querySelectorAll(t.params.buyVideoButton);[].forEach.call(o,function(e){MG_Utils.addEventHandler(e,"click",function(e){t.triggerPurchaseFlow()})}),t.params.showSuccessModal&&purchaseFlow_Utils.openSuccessModal(".modalMTubes.videoPurchaseFlowModal",t.params,t.purchaseFlowModal,function(e){ga("send","event","Success Modal","click","Click on modal")}),t.params.showFailureModal&&(t.purchaseFlowModal.openModal(),e=document.querySelector(".modalMTubes.videoPurchaseFlowModal"),purchaseFlow_Utils.openSelectedModal(".pf_failure_modal",e),MG_Utils.addClass(e,"redirect_on_close"),purchaseFlow_Utils.addModalCloseListeners(e,t.params,t.purchaseFlowModal),a=purchaseFlow_Utils.getCurrentOpenedModal(e,!0).querySelector(".js_retryPurchase"),purchaseFlow_Utils.addFailureModalTryAgainListener(e,a,t.params.tryAgainUrl,t.getAjaxData(!1,1)),ga("send","event","Transaction Failed Modal","click","Modal Shown"))},t.triggerPurchaseFlow=function(){t.purchaseFlowModal.openModal(function(){var e,o=document.querySelector(".modalMTubes.videoPurchaseFlowModal");t.params.last4?(purchaseFlow_Utils.openSelectedModal(".js-purchaseDigitsModal",o),t.addLastDigitEventListeners(o)):(purchaseFlow_Utils.openSelectedModal(".js-purchaseModal",o),(e=purchaseFlow_Utils.getCurrentOpenedModal(o,!0)).addEventListener("click",function(e){var a=e.target;a&&MG_Utils.hasClass(a,"js-purchaseVideoButton")&&(a.setAttribute("disabled",!0),t.params.liu?t.probillerAjax(o,t.params.probillerUrl,a):(purchaseFlow_Utils.openSelectedModal(".login_signup_modal",o),purchaseFlow_LoginSignup.addListeners(o,videoPurchaseFlow)))}),purchaseFlow_Utils.addChangeCCListeners(e,t.params.probillerCreditCard,!0,videoPurchaseFlow)),purchaseFlow_Utils.addModalCloseListeners(o,t.params,t.purchaseFlowModal),purchaseFlow_Utils.addLeaveModalListeners(o,t.params,t.purchaseFlowModal),purchaseFlow_Utils.setupCouponCode(o,videoPurchaseFlow)})},t.probillerAjax=function(a,e,o){var s=purchaseFlow_Utils.getCurrentOpenedModal(a,!0).querySelector(".jsBuyVideoError");purchaseFlow_Utils.toggleLoading(a,o,"show"),MG_Utils.addClass(o,"disabled"),MG_Utils.ajaxCall({url:e,type:"POST",data:t.getAjaxData(),success:function(e){purchaseFlow_Utils.showCreditCardModal(e)?(t.setupCreditCardPriceLabels(a),purchaseFlow_Utils.setupCreditCardModal(a,t.params.probillerUrl,t.params.price,t.getAjaxData())):"FAIL"==e.success||e.error?(s.innerHTML=e.message,purchaseFlow_Utils.toggleLoading(a,o,"hide"),o.removeAttribute("disabled")):(s.innerHTML="","undefined"!=typeof mixpanel&&(mixpanel.identify(e.MixpanelEvent.userId),mixpanel.track(e.MixpanelEvent.eventName,e.MixpanelEvent.event)),window.location.href=e.redirectUrl)}})},t.handleAfterLoginSignup=function(e,a){var o;void 0!==a.liuIsOwner&&a.liuIsOwner?window.location.reload(!0):(MG_Utils.removeClass(e,"leave_confirmation"),MG_Utils.addClass(e,"reload_on_close"),void 0!==a.newToken&&a.newToken&&(t.params.token=a.newToken),void 0!==a.dismissUrl&&(t.params.dismissUrl=a.dismissUrl),void 0!==a.al&&(t.params.premiumUserInfo=a.al),void 0!==a.last4Required&&a.last4Required?(purchaseFlow_Utils.openSelectedModal(".videoPurchaseDigitsModal",e),t.addLastDigitEventListeners(e,a),o=t.params.couponCode,purchaseFlow_Utils.setupCouponCode(e,videoPurchaseFlow),o&&couponCodeModule.applyCoupon(o)):void 0!==a.alreadyBought&&a.alreadyBought?(purchaseFlow_Utils.openSelectedModal(".js-alreadyBoughtModal",e),void 0!==a.profileUrl&&e.querySelector(".js_alreadyBought").setAttribute("data-url",a.profileUrl),MG_Utils.addEventHandler(e.querySelector(".js_alreadyBought"),"click",function(e){t.purchaseFlowModal.closeModal(function(){window.location.href=e.target.getAttribute("data-url")})})):purchaseFlow_Utils.showCreditCardModal(a)?(t.setupCreditCardPriceLabels(e,e.querySelector(".videoPurchaseModal")),purchaseFlow_Utils.setupCreditCardModal(e,t.params.probillerUrl,t.params.price,t.getAjaxData())):void 0!==a.redirectUrl&&(window.location.href=a.redirectUrl))},t.addLastDigitEventListeners=function(e,a){a=void 0!==a&&a;var o=purchaseFlow_Utils.getCurrentOpenedModal(e,!0),s=o.querySelector(".jsLastDigitsSubmit");pfLast4.init(e,videoPurchaseFlow,a),s&&s.addEventListener("click",function(){MG_Utils.hasClass(s,"disabled")||(MG_Utils.addClass(s,"disabled"),t.handleLastDigitsAjax(e,o,pfLast4.getLast4(o),s))}),purchaseFlow_Utils.addChangeCCListeners(o,t.params.probillerCreditCard,!0,videoPurchaseFlow)},t.handleLastDigitsAjax=function(a,e,o,s){purchaseFlow_Utils.toggleLoading(a,s,"show");var l=e.querySelector(".pfLastDigitsError");l&&(MG_Utils.removeClass(l,"active"),l.innerHTML=""),MG_Utils.ajaxCall({type:"POST",data:t.getAjaxData(o),url:t.params.probillerUrl,success:function(e){"FAIL"==e.success||e.error?(l&&(MG_Utils.addClass(l,"active"),l.innerHTML=e.message),purchaseFlow_Utils.toggleLoading(a,s,"hide"),s&&MG_Utils.removeClass(s,"disabled")):window.location.href=e.redirectUrl}})},t.getAjaxData=function(e,a){e=void 0!==e&&e,a=void 0!==a&&a;var o={};return t.params.token&&(o.token=t.params.token),t.params.premiumUserInfo&&(o.al=t.params.premiumUserInfo),e&&(o.last4=e),t.params.couponCode&&(o.couponCode=t.params.couponCode),a&&(o.tryAgain=a),o},t.setupCreditCardPriceLabels=function(e,a){a=void 0!==a?a:purchaseFlow_Utils.getCurrentOpenedModal(e,!0);var o,s,l=e.querySelector(".pfCreditCardModal"),r=!!a&&a.querySelector(".js-pfPurchasePrice").cloneNode(!0);l&&r&&((s=r.querySelector(".strikethrough"))&&r.getAttribute("data-percent"),s&&r.removeChild(s),o=r.innerText.replace(/\s/g,""),"v1"==CREDIT_CARD_FORM.version&&(t.params.price=o))}};try{var videoPurchaseFlow=new VideoPurchaseFlow;videoPurchaseFlow.init("undefined"!=typeof Video_PurchaseFlow_Params?Video_PurchaseFlow_Params:{})}catch(e){console.log("ERROR === Video Purchase Flow ==="),console.log(e)}
!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).CreditCard=e()}(function(){return function a(u,o,l){function f(r,e){if(!o[r]){if(!u[r]){var t="function"==typeof require&&require;if(!e&&t)return t(r,!0);if(s)return s(r,!0);var n=new Error("Cannot find module '"+r+"'");throw n.code="MODULE_NOT_FOUND",n}var i=o[r]={exports:{}};u[r][0].call(i.exports,function(e){return f(u[r][1][e]||e)},i,i.exports,a,u,o,l)}return o[r].exports}for(var s="function"==typeof require&&require,e=0;e<l.length;e++)f(l[e]);return f}({1:[function(e,r,t){"use strict";var n=function(e,r,t){return r&&i(e.prototype,r),t&&i(e,t),e};function i(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=e("./creditCardList"),u=e("./helpers/luhn"),o=(n(l,[{key:"retrieveCreditCardList",value:function(){return this.creditcardlist.retrieveCreditCardList()}},{key:"isValid",value:function(e){return this.luhn.isValid(e)}},{key:"getCreditCardNameByNumber",value:function(e){for(var r=this.retrieveCreditCardList(),t=0;t<r.length;t++){var n=r[t];if(n.regexpFull.test(e))return n.name}return"Credit card is invalid!"}},{key:"isSecurityCodeValid",value:function(e,r){var t=this.getCreditCardNameByNumber(e);return new RegExp("^[0-9]{"+("Amex"===t?4:3)+"}$").test(r)}},{key:"isExpirationDateValid",value:function(e,r){var t=parseInt(e,10),n=parseInt(r,10),i=(new Date).getFullYear(),a=(new Date).getMonth()+1;return!isNaN(t)&&!isNaN(n)&&(!(n===i&&t<a)&&(!(t<1||12<t)&&!(n<1e3||3e3<=n)))}}]),l);function l(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,l),this.creditcardlist=new a,this.luhn=new u}r.exports=o},{"./creditCardList":2,"./helpers/luhn":3}],2:[function(e,r,t){"use strict";function n(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=[{name:"Elo",regexpFull:/^(401178|401179|431274|438935|451416|457393|457631|457632|504175|627780|636297|636368|(506699|5067[0-6]\d|50677[0-8])|(50900\d|5090[1-9]\d|509[1-9]\d{2})|65003[1-3]|(65003[5-9]|65004\d|65005[0-1])|(65040[5-9]|6504[1-3]\d)|(65048[5-9]|65049\d|6505[0-2]\d|65053[0-8])|(65054[1-9]|6505[5-8]\d|65059[0-8])|(65070\d|65071[0-8])|65072[0-7]|(65090[1-9]|65091\d|650920)|(65165[2-9]|6516[6-7]\d)|(65500\d|65501\d)|(65502[1-9]|6550[3-4]\d|65505[0-8]))[0-9]{10,12}/},{name:"Diners",regexpFull:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/},{name:"Discover",regexpFull:/^6(?:011|5[0-9]{2}|4[4-9][0-9]{1}|(22(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[01][0-9]|92[0-5]$)[0-9]{10}$))[0-9]{12}$/},{name:"Hipercard",regexpFull:/^(38[0-9]{17}|60[0-9]{14})$/},{name:"Amex",regexpFull:/^3[47][0-9]{13}$/},{name:"Aura",regexpFull:/^50[0-9]{14,17}$/},{name:"Mastercard",regexpFull:/^(5[1-5][0-9]{14}|2221[0-9]{12}|222[2-9][0-9]{12}|22[3-9][0-9]{13}|2[3-6][0-9]{14}|27[01][0-9]{13}|2720[0-9]{12})$/},{name:"Visa",regexpFull:/^4[0-9]{12}(?:[0-9]{3})?$/},{name:"JCB",regexpFull:/^(?:(?:2131|1800|35\d{3})\d{11})$/}],a=(function(e,r,t){return r&&n(e.prototype,r),t&&n(e,t),e}(u,[{key:"retrieveCreditCardList",value:function(){return this.list}}]),u);function u(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,u),this.list=i}r.exports=a},{}],3:[function(e,r,t){"use strict";function n(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var i=(function(e,r,t){return r&&n(e.prototype,r),t&&n(e,t),e}(a,[{key:"_sum",value:function(e){for(var r,t=0,n=e.length,i=!0;n--;)r=Number(e[n]),t+=(i=!i)?this.computed[r]:r;return t}},{key:"isValid",value:function(e){var r=e;if(new RegExp("/[^0-9-s]+/").test(r))return!1;r=r.replace(/\D/g,"");var t=this._sum(r);return 0<t&&t%10==0}}]),a);function a(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,a),this.computed=[0,2,4,6,8,1,3,5,7,9]}r.exports=i},{}]},{},[1])(1)});
var CC_GLOBAL={},cc_setGlobalVariables=function(e,t){e=void 0!==e?e:document,CC_GLOBAL={container:e,version:t,form:e.querySelector(".creditCardForm"),expiryYearField:e.querySelector(".expiryYear"),expiryMonthField:e.querySelector(".expiryMonth"),paymentLoader:e.querySelector(".paymentLoader"),expiryContainer:e.querySelector(".floatExpiryDate"),error_expiryDateElm:e.querySelector(".error_expiryDate"),error_securityCodeElm:e.querySelector(".error_securityCode"),cardNumberInput:e.querySelector(".cardNumber"),firstnameInput:e.querySelector(".firstName"),lastnameInput:e.querySelector(".lastName"),cvvInput:e.querySelector(".securityCode"),zipInput:e.querySelector(".zipCode")}},GLOBAL_PB_MONITORING={purchaseType:"",purchaseUUID:""},creditCardModule=function(){function s(e){var t={uuid:CREDIT_CARD_MODAL.apiPornhubUUID?CREDIT_CARD_MODAL.apiPornhubUUID:"",response:e};void 0!==CREDIT_CARD_MODAL.premiumUserInfo&&CREDIT_CARD_MODAL.premiumUserInfo&&(t.al=CREDIT_CARD_MODAL.premiumUserInfo),MG_Utils.ajaxCall({type:"POST",url:CREDIT_CARD_MODAL.validationUrl,data:t,success:function(e){var t;1!==e.success&&e.error||!e.redirectUrl?(e.messages&&(e.messages.general?d(e.messages.general):d(CC_VALIDATION_MESSAGES.validationError)),CC_GLOBAL.paymentLoader&&MG_Utils.addClass(CC_GLOBAL.paymentLoader,"displayNone")):(LocalStorageManager.getInstance().get("dataProductID")&&LocalStorageManager.getInstance().remove("dataProductID"),(t=e).pornhubUUID?MG_Utils.ajaxCall({type:"POST",url:WIDGET_PREMIUM_SIGNUP.legacyPbTrackingUrl,requestType:"text/json; charset=UTF-8",data:{pornhubUUID:t.pornhubUUID,redirect:t.redirect?t.redirect:"",success:t.success?t.success:"",user:t.user?t.user:"",username:t.username?t.username:"",message:t.message?t.message:"",entry:"web/cdn_files/js/purchase/credit_card_form.js line 162"},success:function(){window.location.href=t.redirectUrl}}):window.location.href=t.redirectUrl)},error:function(){CC_GLOBAL.paymentLoader&&MG_Utils.addClass(CC_GLOBAL.paymentLoader,"displayNone"),console.log("Error in payment validation")}})}function o(){var e,t="v2"==CC_GLOBAL.version?(e=creditCardV2.getCleanedExpiryValue(CC_GLOBAL.expiryYearField,"year",!0),creditCardV2.getCleanedExpiryValue(CC_GLOBAL.expiryMonthField,"month",!0)):(e=-1!=CC_GLOBAL.expiryYearField.selectedIndex?CC_GLOBAL.expiryYearField.options[CC_GLOBAL.expiryYearField.selectedIndex].text:CC_GLOBAL.expiryYearField.options[0].text,-1!=CC_GLOBAL.expiryMonthField.selectedIndex?CC_GLOBAL.expiryMonthField.options[CC_GLOBAL.expiryMonthField.selectedIndex].text.substr(0,2):CC_GLOBAL.expiryMonthField.options[0].text.substr(0,2)),i=CC_GLOBAL.cardNumberInput.value.replace(/ /g,""),r={"apiModeFields[firstname]":CC_GLOBAL.firstnameInput.value,"apiModeFields[lastname]":CC_GLOBAL.lastnameInput.value,"apiModeFields[number]":i,"apiModeFields[cvv]":CC_GLOBAL.cvvInput.value,"apiModeFields[expirationMonth]":t,"apiModeFields[expirationYear]":e,"apiModeFields[zip]":CC_GLOBAL.zipInput.value.replace(/ /g,"")};CREDIT_CARD_MODAL.apiRedirectPayload&&(r.request=CREDIT_CARD_MODAL.apiRedirectPayload);var a,n=new XMLHttpRequest,l="";for(a in r)""!=l&&(l+="&"),l+=a+"="+encodeURIComponent(r[a]);n.open("POST",CREDIT_CARD_MODAL.submitPaymentUrl,!0),n.responseType="text",n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),n.setRequestHeader("Access-Control-Allow-Origin",CREDIT_CARD_MODAL.domain),n.onreadystatechange=function(){var e,t,r,a;4==n.readyState&&(t={httpResponseCode:e=n.response,joinPage:"undefined"!=typeof WIDGET_PREMIUM_SIGNUP&&WIDGET_PREMIUM_SIGNUP.joinPage?WIDGET_PREMIUM_SIGNUP.joinPage:"",apiRedirectPayload:CREDIT_CARD_MODAL.apiRedirectPayload,responseStatus:n.status,binTrackingNumber:i.substring(0,6)},""!==GLOBAL_PB_MONITORING.purchaseUUID&&"fanclub"===GLOBAL_PB_MONITORING.purchaseType&&(a=t,void 0!==GLOBAL_PB_MONITORING.purchaseUUID&&""!==GLOBAL_PB_MONITORING.purchaseUUID&&MG_Utils.ajaxCall({type:"POST",url:CREDIT_CARD_MODAL.probillerMonitoringFanclubApi,requestType:"text/json; charset=UTF-8",data:{pornhubUUID:GLOBAL_PB_MONITORING.purchaseUUID,httpResponseCode:a.responseStatus,apiRedirectPayload:a.apiRedirectPayload,joinPage:a.joinPage}})),r=t,CREDIT_CARD_MODAL.apiPornhubUUID&&MG_Utils.ajaxCall({type:"POST",url:CREDIT_CARD_MODAL.pbCallTrackingUrl,requestType:"text/json; charset=UTF-8",data:{pornhubUUID:CREDIT_CARD_MODAL.apiPornhubUUID,httpResponseCode:r.responseStatus,apiRedirectPayload:r.apiRedirectPayload,joinPage:r.joinPage,binTrackingNumber:r.binTrackingNumber}}),e&&"object"!=typeof e?s(e):e&&e.responseText?s(e.responseText):CC_GLOBAL.paymentLoader&&MG_Utils.addClass(CC_GLOBAL.paymentLoader,"displayNone"))},n.send(l)}function d(e,t){t=void 0!==t?t:CC_GLOBAL.container.querySelector(".error_generalMessage"),e&&t&&(t.textContent=e,MG_Utils.addClass(t,"active"))}return{init:function(e,t){var r,a,i;e=void 0!==e?e:document,cc_setGlobalVariables(e,t=void 0!==t?t:"v1"),creditCardListeners.init(CC_GLOBAL.version),"v1"==CC_GLOBAL.version&&(i=1==(a=(r=new Date).getMonth()+1).toString().length?"0"+a:a+"",CC_GLOBAL.expiryYearField&&(CC_GLOBAL.expiryYearField.value=r.getFullYear()),CC_GLOBAL.expiryMonthField&&(CC_GLOBAL.expiryMonthField.value=i+"-"+["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][a-1]));var n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),l=navigator.userAgent.match(/firefox/i);n&&MG_Utils.addClass(document.body,"safariDetected"),l&&MG_Utils.addClass(document.body,"firefoxDetected"),MG_Utils.addEventHandler(e,"click",function(e){!function(r){{var a,i,n,e,t;r.target&&"addBrazzers"===r.target.id&&(a="27923",i=CC_GLOBAL.container.querySelector(".submitPayment"),n=CC_GLOBAL.container.querySelector(".crossSellContainer"),e=window.location.search,t="",-1<e.indexOf("pp=")&&(e=e.substring(e.indexOf("pp=")+3),t=-1!=e.indexOf("&")?e.substring(0,e.indexOf("&")):e),void 0!==WIDGET_PREMIUM_SIGNUP.newUserProductId&&(a=WIDGET_PREMIUM_SIGNUP.newUserProductId),i&&n&&(MG_Utils.addClass(n,"disabledLoading"),r.target.setAttribute("disabled",!0),MG_Utils.addClass(i,"disabledLoading"),i.setAttribute("disabled",!0)),MG_Utils.ajaxCall({type:"POST",url:WIDGET_PREMIUM_SIGNUP.purchaseApiUrl,data:{user:r.target.value,isCrossSell:r.target.checked,productId:a,dbPackageId:t||0,joinPage:WIDGET_PREMIUM_SIGNUP.joinPage},success:function(e){var t;e&&e[a]&&((t=e[a]).apiRedirectUrl&&(CREDIT_CARD_MODAL.submitPaymentUrl=t.apiRedirectUrl),t.apiPornhubUUID&&(CREDIT_CARD_MODAL.apiPornhubUUID=t.apiPornhubUUID),t.apiRedirectPayload&&(CREDIT_CARD_MODAL.apiRedirectPayload=t.apiRedirectPayload),i&&n&&(MG_Utils.removeClass(n,"disabledLoading"),r.target.removeAttribute("disabled",!0),MG_Utils.removeClass(i,"disabledLoading"),i.removeAttribute("disabled")))},error:function(){return CC_GLOBAL.container.querySelector("#addBrazzers").checked=!1}}))}}(e),function(e){if(e.target&&MG_Utils.hasClass(e.target,"submitPayment")){if(!CC_GLOBAL.expiryContainer||MG_Utils.hasClass(CC_GLOBAL.expiryContainer,"wrong")||MG_Utils.hasClass(CC_GLOBAL.expiryContainer,"correct")||creditCardValidationModule.checkExpiryDate(),6!=CC_GLOBAL.container.querySelectorAll(".floatContainer.correct").length)return creditCardValidationModule.validateAllFields();CC_GLOBAL.paymentLoader&&MG_Utils.removeClass(CC_GLOBAL.paymentLoader,"displayNone"),void 0!==CREDIT_CARD_MODAL.submitPaymentUrl&&CREDIT_CARD_MODAL.submitPaymentUrl&&!CREDIT_CARD_MODAL.alwaysGetProbillerApi?o():void 0!==CREDIT_CARD_MODAL.getProbillerApiUrl&&CREDIT_CARD_MODAL.getProbillerApiUrl&&function(){var e={apiMode:!0};void 0!==CREDIT_CARD_MODAL.getProbillerApiAjaxData&&CREDIT_CARD_MODAL.getProbillerApiAjaxData&&(e=MG_Utils.extendSimple(e,CREDIT_CARD_MODAL.getProbillerApiAjaxData));MG_Utils.ajaxCall({type:"POST",url:CREDIT_CARD_MODAL.getProbillerApiUrl,data:e,success:function(e){e.success&&"FAIL"!=e.success||void 0!==e.error&&!e.error?(CREDIT_CARD_MODAL.submitPaymentUrl=e.redirectUrl,"undefined"!=typeof purchaseFlow_Utils&&(void 0!==e.transactionId&&(purchaseFlow_Utils.trackingCreditCardParams.transactionId=e.transactionId),purchaseFlow_Utils.trackCreditCardModal(PF_CREDITCARDMODAL_TRACKING.trackingStatus.ccFormSubmit)),void 0!==e.pbMonitoring&&(GLOBAL_PB_MONITORING.purchaseType=e.pbMonitoring.type,GLOBAL_PB_MONITORING.purchaseUUID=e.pbMonitoring.uuid),o()):(CC_GLOBAL.paymentLoader&&MG_Utils.addClass(CC_GLOBAL.paymentLoader,"displayNone"),e.message&&d(e.message))},error:function(){CC_GLOBAL.paymentLoader&&MG_Utils.addClass(CC_GLOBAL.paymentLoader,"displayNone")}})}()}}(e)})},getCreditCardType:function(e){var t="none";return/^5/.test(e)?t="mastercard":/^4/.test(e)?t="visa":/^6/.test(e)?t="discover":/^352[89]|^35[3-8][0-9]/.test(e)?t="jcb":/^$/.test(e)&&(t="all"),t}}}(),creditCardValidationModule=function(){var i=new CreditCard;function l(e){for(var t=creditCardModule.getCreditCardType(e),r=CC_GLOBAL.container.querySelectorAll(".newUserPaymentWrapper .cardImgWrapper"),a=0;a<r.length;a++)"all"==t||"none"!=t&&MG_Utils.hasClass(r[a],t)?r[a].style.display="inline-block":r[a].style.display="none"}function s(e,t,r){var a,i=0,n=0,l=e.value;!1!==t&&(i=e.selectionStart,a=e.selectionEnd,r&&0<i&&" "==l[--i]&&i--,l=l.substring(0,i)+t+l.substring(a),n=i+t.length);for(var s=0,o=0,d="",C=[4,4,4,4],c=0;c<l.length&&(/\D/.test(l[c])?c<i&&n--:(s===C[o]&&(d+=" ",s=0,o++,c<=i&&n++),d+=l[c],s++,0),s!==C[o]||C.length!==o+1);c++);e.value=d,!1!==t&&e.setSelectionRange(n,n)}function o(e,t,r,a){var i="v2"==CC_GLOBAL.version?closestElement(t,".floatContainer"):t.parentElement;(a=void 0!==a?a:"v2"==CC_GLOBAL.version?i.querySelector(".errorMessage"):i.nextElementSibling)&&("invalid"==e?(r&&(a.textContent=r),MG_Utils.addClass(i,"wrong"),MG_Utils.addClass(a,"active"),MG_Utils.removeClass(i,"correct")):"valid"==e?(r&&(a.textContent=r),MG_Utils.removeClass(i,"wrong"),MG_Utils.removeClass(a,"active"),MG_Utils.addClass(i,"correct")):"errTextOnly"==e&&(a.textContent=r))}return{onBlur:function(e){var t,r,a="v2"==CC_GLOBAL.version?closestElement(e,".floatContainer"):e.parentElement;e&&a?(t=CC_GLOBAL.container.querySelectorAll(".error_securityCode"),r="v2"==CC_GLOBAL.version?a.querySelector(".errorMessage"):a.nextElementSibling,0==e.value.length&&MG_Utils.removeClass(a,"active"),0<e.value.length?(MG_Utils.removeClass(a,"wrong"),MG_Utils.hasClass(a,"floatSecurityCode")?MG_Utils.removeClassMultiple(t,"active"):r&&MG_Utils.removeClass(r,"active")):(r&&MG_Utils.addClass(a,"wrong"),MG_Utils.hasClass(a,"floatSecurityCode")?MG_Utils.addClassMultiple(t,"active"):r&&MG_Utils.addClass(r,"active"),MG_Utils.removeClass(a,"correct"))):(r&&MG_Utils.addClass(a,"wrong"),r&&MG_Utils.addClass(r,"active"))},onFocus:function(e){var t="v2"==CC_GLOBAL.version?closestElement(e,".floatContainer"):e.parentElement;t&&MG_Utils.addClass(t,"active")},onCCKeyDown:function(e){0<e.value.length&&(!event.keyCode||8===event.keyCode||46===event.keyCode)&&(event.preventDefault(),s(e,!!event.keyCode&&"",e.selectionStart===e.selectionEnd),l(e.value.replace(/ /g,"")))},onKeyPress:function(e){var t=new RegExp(/^[A-Z@~`!@#$%^&*()_=+\\\\';:\"\\/?>.<,-]*$/i),r="v2"==CC_GLOBAL.version?closestElement(e,".floatContainer"):e.parentElement,a="v2"==CC_GLOBAL.version?r.querySelector(".errorMessage"):r.nextElementSibling;if("Backspace"!=event.key&&13!==event.keyCode&&t.test(event.key))return a.textContent=CC_VALIDATION_MESSAGES.enterDigitsOnly,MG_Utils.addClass(r,"wrong"),MG_Utils.addClass(a,"active"),!1;var i=event.charCode||event.keyCode||event.which;if(8!==i&&9!==i&&(i<37||40<i)&&(!event.ctrlKey||99!==i&&118!==i)){event.preventDefault();var n=String.fromCharCode(i);if(/\D/.test(n))return!1;s(e,n)}l(e.value.replace(/ /g,""))},checkName:function(e,t){var r=new RegExp(/^[a-z\s-]{2,}$/i),a=3==t?CC_VALIDATION_MESSAGES.firstName:CC_VALIDATION_MESSAGES.lastName,i="v2"==CC_GLOBAL.version?e.parentElement.querySelector(".errorMessage"):e.parentElement.nextElementSibling;0!=e.value.length?e.value.length<t&&i?o("invalid",e,CC_VALIDATION_MESSAGES.validField+a+"!"):r.test(e.value)?o("valid",e,a+CC_VALIDATION_MESSAGES.required):o("invalid",e,CC_VALIDATION_MESSAGES.alphaOnly+a+"!"):o("errTextOnly",e,a+CC_VALIDATION_MESSAGES.required)},checkCreditCard:function(e){var t,r,a="v2"==CC_GLOBAL.version?closestElement(e,".floatContainer"):e.parentElement;s(e,!1),0!=e.value.length?(r="",null==(t=e.value.replace(/ /g,"")).match(/^[0-9]+$/)?o("invalid",e,CC_VALIDATION_MESSAGES.enterDigitsOnly):"2"!=t.substr(0,1)&&"3"!=t.substr(0,1)&&"4"!=t.substr(0,1)&&"5"!=t.substr(0,1)&&"6"!=t.substr(0,1)?o("invalid",e,CC_VALIDATION_MESSAGES.inValidCard):"34"==t.substr(0,2)||"37"==t.substr(0,2)?o("invalid",e,CC_VALIDATION_MESSAGES.noAmexCard):(t.length<12||19<t.length)&&!MG_Utils.hasClass(a,"wrong")?o("invalid",e,CC_VALIDATION_MESSAGES.cardNbrLength):!function(e){for(var t=e.length,r=t%2,a=0,i=t-1;0<=i;i--){var n=parseInt(e.charAt(i));i%2==r&&(n*=2),9<n&&(n-=9),a+=n}return a%10==0}(t)?o("invalid",e,CC_VALIDATION_MESSAGES.validCardNbr):(12<=t.length||t.length<=19)&&(r=i.getCreditCardNameByNumber(t),i.isValid(t)?"Visa"==r||"Discover"==r||"Mastercard"==r||"JCB"==r?MG_Utils.addClass(a,"correct"):o("invalid",e,CC_VALIDATION_MESSAGES.inValidCard):o("invalid",e,CC_VALIDATION_MESSAGES.validCardNbr))):(o("errTextOnly",e,CC_VALIDATION_MESSAGES.cardNbrReq),l(e.value.replace(/ /g,"")))},checkLength:function(e){0!=e.value.length?3!==e.value.length&&CC_GLOBAL.error_securityCodeElm?o("invalid",e,CC_VALIDATION_MESSAGES.validCVV,CC_GLOBAL.error_securityCodeElm):o("valid",e,CC_VALIDATION_MESSAGES.cvvReq,CC_GLOBAL.error_securityCodeElm):o("errTextOnly",e,CC_VALIDATION_MESSAGES.cvvReq,CC_GLOBAL.error_securityCodeElm)},checkExpiryDate:function(){var e,t,r,a=new Date,i=a.getMonth()+1,n=a.getFullYear(),l="v2"==CC_GLOBAL.version?(r=creditCardV2.getCleanedExpiryValue(CC_GLOBAL.expiryMonthField,"month"),creditCardV2.getCleanedExpiryValue(CC_GLOBAL.expiryYearField,"year")):(e=CC_GLOBAL.expiryMonthField&&-1!=CC_GLOBAL.expiryMonthField.selectedIndex?CC_GLOBAL.expiryMonthField.selectedIndex:0,t=CC_GLOBAL.expiryYearField&&-1!=CC_GLOBAL.expiryYearField.selectedIndex?CC_GLOBAL.expiryYearField.selectedIndex:0,r=CC_GLOBAL.expiryMonthField&&CC_GLOBAL.expiryMonthField.options&&CC_GLOBAL.expiryMonthField.options[e].text?parseInt(CC_GLOBAL.expiryMonthField.options[e].text.substr(0,2)):"",CC_GLOBAL.expiryYearField&&CC_GLOBAL.expiryYearField.options?parseInt(CC_GLOBAL.expiryYearField.options[t].text):"");""!==r&&""!==l?r<1||12<r||l<n||r<i&&n==l||n+9<l?o("invalid",CC_GLOBAL.expiryMonthField.parentElement,CC_VALIDATION_MESSAGES.expiryInvalid,CC_GLOBAL.error_expiryDateElm):(MG_Utils.removeClass(CC_GLOBAL.error_expiryDateElm,"active"),MG_Utils.removeClass(CC_GLOBAL.expiryContainer,"wrong"),MG_Utils.addClass(CC_GLOBAL.expiryContainer,"correct")):o("invalid",CC_GLOBAL.expiryMonthField.parentElement,CC_VALIDATION_MESSAGES.expiryReq,CC_GLOBAL.error_expiryDateElm)},checkZipCode:function(e){var t=new RegExp(/^[a-zA-Z0-9 ]+$/);0!=e.value.length?e.value.length<3||10<e.value.length||!t.test(e.value)?o("invalid",e,CC_VALIDATION_MESSAGES.invalidZipFormat):o("valid",e,CC_VALIDATION_MESSAGES.zipReq):o("errTextOnly",e,CC_VALIDATION_MESSAGES.zipReq)},validateAllFields:function(){for(var e=["cardNumber","securityCode","firstName","lastName","zipCode"],t=0;t<e.length;t++){var r=CC_GLOBAL.container.querySelector("."+e[t]),a=CC_GLOBAL.container.querySelector(".error_"+e[t]);r&&!r.value&&a&&(MG_Utils.addClass(r.parentElement,"wrong"),MG_Utils.addClass(a,"active"))}},checkMaxLength:function(e){var t=e.getAttribute("maxlength");e.value.length>t&&(e.value=e.value.slice(0,t))}}}(),creditCardListeners=function(){function e(e){e.target&&MG_Utils.hasClass(e.target,"secureInput")&&e.preventDefault()}function a(e){var t=e.target;t&&(MG_Utils.hasClass(t,"floatFields")&&creditCardValidationModule.onBlur(t),MG_Utils.hasClass(t,"cardNumber")&&creditCardValidationModule.checkCreditCard(t),MG_Utils.hasClass(t,"securityCode")&&creditCardValidationModule.checkLength(t),(MG_Utils.hasClass(t,"firstName")||MG_Utils.hasClass(t,"lastName"))&&creditCardValidationModule.checkName(t,t.getAttribute("minLength")),MG_Utils.hasClass(t,"zipCode")&&creditCardValidationModule.checkZipCode(t))}function t(e){e.target&&(MG_Utils.hasClass(e.target,"expiryMonth")||MG_Utils.hasClass(e.target,"expiryYear"))&&creditCardValidationModule.checkExpiryDate()}return{init:function(){var i=CC_GLOBAL.form.querySelector(".newUserPaymentWrapper"),r=CC_GLOBAL.form.querySelector(".submitPayment");i&&(i.addEventListener("keypress",function(e){var t;e.target&&(t=e.target,MG_Utils.hasClass(t,"cardNumber")&&creditCardValidationModule.onKeyPress(t),MG_Utils.hasClass(t,"maxLenInput")&&!(window.getSelection()&&window.getSelection().anchorNode==t.parentElement)&&t.value.length>=Number(t.getAttribute("maxlength"))&&e.preventDefault())},!0),i.addEventListener("keydown",function(e){var t;e.target&&(MG_Utils.hasClass(e.target,"numInput")&&(t=e.keyCode||e.which,-1==[9,8,46,13,16,229].indexOf(t)&&(t<37||40<t)&&(t<48||57<t)&&(t<96||105<t)&&e.preventDefault()),MG_Utils.hasClass(e.target,"cardNumber")&&creditCardValidationModule.onCCKeyDown(e.target),MG_Utils.hasClass(e.target,"floatFields")&&13==e.keyCode&&(a(e),6==CC_GLOBAL.container.querySelectorAll(".floatContainer.correct").length&&r&&r.click()))},!0),i.addEventListener("input",function(e){e.target&&MG_Utils.hasClass(e.target,"cardNumber")&&creditCardValidationModule.onCCKeyDown(e.target)},!0),i.addEventListener("focus",function(e){e.target&&MG_Utils.hasClass(e.target,"floatFields")&&creditCardValidationModule.onFocus(e.target)},!0),i.addEventListener("blur",a,!0),i.addEventListener("copy",e,!0),i.addEventListener("paste",e,!0),i.addEventListener("cut",e,!0),"v1"==CC_GLOBAL.version?i.addEventListener("change",t,!0):"v2"==CC_GLOBAL.version&&(i.addEventListener("focusout",function(e){var t,r,a,i,n=e.target;n&&(MG_Utils.hasClass(n,"expiryMonth")||MG_Utils.hasClass(n,"expiryYear"))&&(t=e.relatedTarget,r=""==n.value,a=!!MG_Utils.hasClass(n,"expiryMonth")&&(!r&&t&&MG_Utils.hasClass(t,"expiryYear")),i=!!MG_Utils.hasClass(n,"expiryYear")&&(!r&&t&&MG_Utils.hasClass(t,"expiryMonth")),a||i||creditCardValidationModule.checkExpiryDate())},!0),i.addEventListener("input",function(e){var t,r,a=e.target;a&&MG_Utils.hasClass(a,"expiryMonth")&&(t=a.value,r=i.querySelector(".expiryYear"),2==t.length&&r&&r.focus())},!0)))}}}(),creditCardV2={getCleanedExpiryValue:function(e,t,r){r=void 0!==r&&r;var a,i="";return e&&""!==e.value&&(a=1==e.value.length?"0"+e.value:e.value,"month"==t?i=r?a:Number(a):"year"==t&&(i=r?"20"+a:Number("20"+a))),i},setPriceValues:function(e,t,r,a){r=void 0!==r?r:"",a=void 0!==a?a:"";var i,n,l,s=t.querySelector(".newUserPaymentWrapper");s&&(i=s.querySelector(".totalPrice .priceRight"),l=(n=s.querySelector(".savings")).querySelector(".priceRight"),"reset"==e&&(r=i?i.getAttribute("data-original"):"",a=l?l.getAttribute("data-original"):"",n&&MG_Utils.removeClass(n,"active")),i&&(i.innerText=r),n&&(l.innerText=a)&&MG_Utils.addClass(n,"active"))}};
var viewersChoiceFreeVote=function(){var t={};function n(){var e={contestId:VIEWERS_CHOICE_FREE_VOTE.contestId,videoId:VIEWERS_CHOICE_FREE_VOTE.videoId,token:t.token};void 0!==t.al&&(e.al=t.al),MG_Utils.ajaxCall({type:"POST",url:VIEWERS_CHOICE_FREE_VOTE.voteUrl,data:e,success:function(e){"SUCCESS"==e.success||void 0!==e.alreadyVoted&&e.alreadyVoted?o():t.voteButton&&MG_Utils.removeClass(t.voteButton,"disabled")}})}function o(){void 0!==t.contestPagePremiumLoginUrl?window.location.href=t.contestPagePremiumLoginUrl:VIEWERS_CHOICE_FREE_VOTE.redirect?window.location.href=VIEWERS_CHOICE_FREE_VOTE.redirect:window.location.reload(!0)}return{init:function(e){(t={voteButton:e,token:VIEWERS_CHOICE_FREE_VOTE.token}).voteButton&&t.voteButton.addEventListener("click",function(){var e;MG_Utils.hasClass(t.voteButton,"disabled")||("1"==t.voteButton.getAttribute("data-liu")?(MG_Utils.addClass(t.voteButton,"disabled"),n()):(e=document.querySelector(".globalPfLoginSignupContainer"))&&new MG_Modal({content:e,className:"pfLoginSignupModal"}).openModal(function(){var e=document.querySelector(".modalMTubes.pfLoginSignupModal");e&&purchaseFlow_LoginSignup&&(purchaseFlow_LoginSignup.setLoginSignupAjaxUrl(e,VIEWERS_CHOICE_FREE_VOTE.loginSignupUrl),purchaseFlow_LoginSignup.addListeners(e,viewersChoiceFreeVote))}))})},handleAfterLoginSignup:function(e,o){void 0!==o.responseData&&"1"===o.responseData.success?(void 0!==o.responseData.newToken&&(t.token=o.responseData.newToken),void 0!==o.responseData.al&&(t.al=o.responseData.al),void 0!==o.responseData.contestPagePremiumLoginUrl&&(t.contestPagePremiumLoginUrl=o.responseData.contestPagePremiumLoginUrl),n()):t.voteButton&&MG_Utils.removeClass(t.voteButton,"disabled")}}}();MG_Utils.domReady(function(){var e=document.querySelector(".jsViewersChoiceFreeVote");if(e)try{viewersChoiceFreeVote.init(e)}catch(e){console.log(e)}});